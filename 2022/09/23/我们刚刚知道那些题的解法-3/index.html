<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="HYLTianMeng">





<title>我们刚刚知道那些题的解法#3 | HYL&#39;s BLog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
            <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">HYL&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">HYL&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">我们刚刚知道那些题的解法#3</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">HYLTianMeng</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">September 23, 2022&nbsp;&nbsp;11:02:12</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">做题记录</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="NOIPDay1T4"><a href="#NOIPDay1T4" class="headerlink" title="NOIPDay1T4"></a>NOIPDay1T4</h1><p>考虑以下问题，斜率为 $-1$ 的直线上区间加，询问一个点左下角的值的和。</p>
<p>如果线是水平或垂直的，那么显然可以用扫描线来解决。考虑这个题如何扫描线。</p>
<p>首先我们肯定要斜着扫描，扫描的时候注意维护的是 $x$ 轴和 $y$ 轴上的值的和而不是扫描线上的值得和。询问只需要考虑所有扫描过的线段，然后用如图的方式去重即可。</p>
<p><img src="https://pic.imgdb.cn/item/630f461d16f2c2beb1c44c74.png"></p>
<p>本题代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mset(a,b) memset((a),(b),sizeof((a)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,l,r) for(int i=(l);i&lt;=(r);i++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dec(i,l,r) for(int i=(r);i&gt;=(l);i--)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cmax(a,b) (((a)&lt;(b))?(a=b):(a))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cmin(a,b) (((a)&gt;(b))?(a=b):(a))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Next(k) for(int x=head[k];x;x=li[x].next)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> vc vector</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ar array</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pi pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M number</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> dd;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">double</span> ld;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> uint;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; P;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="type">int</span>&gt; vi;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> dd eps=<span class="number">1e-9</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> base=<span class="number">450000</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span> </span>&#123;</span><br><span class="line">    x=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> c=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">for</span>(;!<span class="built_in">isdigit</span>(c);c=<span class="built_in">getchar</span>()) <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) f=-f;</span><br><span class="line">    <span class="keyword">for</span>(;<span class="built_in">isdigit</span>(c);c=<span class="built_in">getchar</span>()) x=x*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    x*=f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,Q;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BIT</span>&#123;</span><br><span class="line">    <span class="type">int</span> p1[N&lt;&lt;<span class="number">1</span>],p2[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> x&amp;(-x);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> w,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!w) <span class="keyword">return</span>;<span class="built_in">assert</span>(w);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=w;i&lt;=<span class="number">2</span>*base;i+=<span class="built_in">lowbit</span>(i)) p1[i]+=x;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=w;i&lt;=<span class="number">2</span>*base;i+=<span class="built_in">lowbit</span>(i)) p2[i]+=x*w;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ask</span><span class="params">(<span class="type">int</span> w)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> res=<span class="number">0</span>;<span class="keyword">if</span>(!w) <span class="keyword">return</span> res;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=w;i;i-=<span class="built_in">lowbit</span>(i)) res+=p1[i];res*=(w<span class="number">+1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=w;i;i-=<span class="built_in">lowbit</span>(i)) res-=p2[i];</span><br><span class="line">        <span class="comment">// printf(&quot;Ask(%d)=%d\n&quot;,w,res);</span></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Clear</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="built_in">mset</span>(p1,<span class="number">0</span>);<span class="built_in">mset</span>(p2,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ask</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(r&lt;l) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Ask</span>(r)-<span class="built_in">Ask</span>(l<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;bitx,bity;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Squ</span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c,d;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> dx,<span class="type">int</span> dy)</span></span>&#123;</span><br><span class="line">        a+=dx;b+=dy;c+=dx;d+=dy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;sq[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Ques</span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r,w;</span><br><span class="line">&#125;;</span><br><span class="line">vc&lt;Ques&gt; qr[N],qc[N],qx[N],qy[N],qqx[N],qqy[N];</span><br><span class="line">vc&lt;Ques&gt; qur[N],quc[N],qux[N],quy[N];</span><br><span class="line"><span class="type">int</span> ans[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;ex_A3.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n);<span class="built_in">read</span>(m);<span class="built_in">read</span>(Q);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="built_in">read</span>(sq[i].a);<span class="built_in">read</span>(sq[i].b);<span class="built_in">read</span>(sq[i].c);<span class="built_in">read</span>(sq[i].d);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,m)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">        <span class="type">int</span> po,id,dis;</span><br><span class="line">        <span class="built_in">read</span>(po);<span class="built_in">read</span>(id);<span class="built_in">read</span>(dis);</span><br><span class="line">        <span class="keyword">if</span>(po==<span class="number">0</span>||po==<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(po==<span class="number">0</span>)&#123;</span><br><span class="line">                qr[sq[id].b].<span class="built_in">pb</span>(&#123;sq[id].a,sq[id].a+dis<span class="number">-1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qr[sq[id].b].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>,sq[id].c<span class="number">+1</span>+dis<span class="number">-1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qr[sq[id].d<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].a,sq[id].a+dis<span class="number">-1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qr[sq[id].d<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>,sq[id].c<span class="number">+1</span>+dis<span class="number">-1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                sq[id].<span class="built_in">Add</span>(dis,<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                qr[sq[id].b].<span class="built_in">pb</span>(&#123;sq[id].a-dis<span class="number">+1</span>,sq[id].a,<span class="number">1</span>&#125;);</span><br><span class="line">                qr[sq[id].b].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>-dis<span class="number">+1</span>,sq[id].c<span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qr[sq[id].d<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].a-dis<span class="number">+1</span>,sq[id].a,<span class="number">-1</span>&#125;);</span><br><span class="line">                qr[sq[id].d<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>-dis<span class="number">+1</span>,sq[id].c<span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                sq[id].<span class="built_in">Add</span>(-dis,<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(po==<span class="number">2</span>||po==<span class="number">6</span>)&#123;</span><br><span class="line">             <span class="keyword">if</span>(po==<span class="number">2</span>)&#123;</span><br><span class="line">                qc[sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].b,sq[id].b+dis<span class="number">-1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qc[sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>,sq[id].d<span class="number">+1</span>+dis<span class="number">-1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qc[sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].b,sq[id].b+dis<span class="number">-1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qc[sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>,sq[id].d<span class="number">+1</span>+dis<span class="number">-1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                sq[id].<span class="built_in">Add</span>(<span class="number">0</span>,dis);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                qc[sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].b-dis<span class="number">+1</span>,sq[id].b,<span class="number">1</span>&#125;);</span><br><span class="line">                qc[sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>-dis<span class="number">+1</span>,sq[id].d<span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qc[sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].b-dis<span class="number">+1</span>,sq[id].b,<span class="number">-1</span>&#125;);</span><br><span class="line">                qc[sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>-dis<span class="number">+1</span>,sq[id].d<span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                sq[id].<span class="built_in">Add</span>(<span class="number">0</span>,-dis);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(po==<span class="number">1</span>||po==<span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(po==<span class="number">1</span>)&#123;</span><br><span class="line">                qx[sq[id].b-sq[id].a<span class="number">+1</span>+base].<span class="built_in">pb</span>(&#123;sq[id].a<span class="number">-1</span><span class="number">+1</span>,sq[id].a<span class="number">-1</span>+dis<span class="number">-1</span><span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qx[sq[id].b-sq[id].c+base].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>,sq[id].c+dis<span class="number">-1</span><span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qx[sq[id].d<span class="number">+1</span>-sq[id].a<span class="number">+1</span>+base].<span class="built_in">pb</span>(&#123;sq[id].a<span class="number">-1</span><span class="number">+1</span>,sq[id].a<span class="number">-1</span>+dis<span class="number">-1</span><span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qx[sq[id].d<span class="number">+1</span>-sq[id].c+base].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>,sq[id].c+dis<span class="number">-1</span><span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qy[sq[id].b-sq[id].a<span class="number">+1</span>+base].<span class="built_in">pb</span>(&#123;sq[id].b<span class="number">+1</span>,sq[id].b+dis<span class="number">-1</span><span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qy[sq[id].b-sq[id].c+base].<span class="built_in">pb</span>(&#123;sq[id].b<span class="number">+1</span>,sq[id].b+dis<span class="number">-1</span><span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qy[sq[id].d<span class="number">+1</span>-sq[id].a<span class="number">+1</span>+base].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span><span class="number">+1</span>,sq[id].d<span class="number">+1</span>+dis<span class="number">-1</span><span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qy[sq[id].d<span class="number">+1</span>-sq[id].c+base].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span><span class="number">+1</span>,sq[id].d<span class="number">+1</span>+dis<span class="number">-1</span><span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                sq[id].<span class="built_in">Add</span>(dis,dis);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                qx[sq[id].b-sq[id].a<span class="number">+1</span>+base].<span class="built_in">pb</span>(&#123;sq[id].a<span class="number">-1</span>-dis<span class="number">+1</span><span class="number">+1</span>,sq[id].a<span class="number">-1</span><span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qx[sq[id].b-sq[id].c+base].<span class="built_in">pb</span>(&#123;sq[id].c-dis<span class="number">+1</span><span class="number">+1</span>,sq[id].c<span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qx[sq[id].d<span class="number">+1</span>-sq[id].a<span class="number">+1</span>+base].<span class="built_in">pb</span>(&#123;sq[id].a<span class="number">-1</span>-dis<span class="number">+1</span><span class="number">+1</span>,sq[id].a<span class="number">-1</span><span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qx[sq[id].d<span class="number">+1</span>-sq[id].c+base].<span class="built_in">pb</span>(&#123;sq[id].c-dis<span class="number">+1</span><span class="number">+1</span>,sq[id].c<span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qy[sq[id].b-sq[id].a<span class="number">+1</span>+base].<span class="built_in">pb</span>(&#123;sq[id].b-dis<span class="number">+1</span><span class="number">+1</span>,sq[id].b<span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qy[sq[id].b-sq[id].c+base].<span class="built_in">pb</span>(&#123;sq[id].b-dis<span class="number">+1</span><span class="number">+1</span>,sq[id].b<span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qy[sq[id].d<span class="number">+1</span>-sq[id].a<span class="number">+1</span>+base].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>-dis<span class="number">+1</span><span class="number">+1</span>,sq[id].d<span class="number">+1</span><span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qy[sq[id].d<span class="number">+1</span>-sq[id].c+base].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>-dis<span class="number">+1</span><span class="number">+1</span>,sq[id].d<span class="number">+1</span><span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                sq[id].<span class="built_in">Add</span>(-dis,-dis);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(po==<span class="number">3</span>||po==<span class="number">7</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(po==<span class="number">3</span>)&#123;</span><br><span class="line">                qqx[sq[id].b+sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].a-dis<span class="number">+1</span>,sq[id].a,<span class="number">1</span>&#125;);</span><br><span class="line">                qqx[sq[id].b+sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>-dis<span class="number">+1</span>,sq[id].c<span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qqx[sq[id].d<span class="number">+1</span>+sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].a-dis<span class="number">+1</span>,sq[id].a,<span class="number">-1</span>&#125;);</span><br><span class="line">                qqx[sq[id].d<span class="number">+1</span>+sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>-dis<span class="number">+1</span>,sq[id].c<span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qqy[sq[id].b+sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].b,sq[id].b+dis<span class="number">-1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qqy[sq[id].b+sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].b,sq[id].b+dis<span class="number">-1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qqy[sq[id].d<span class="number">+1</span>+sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>,sq[id].d<span class="number">+1</span>+dis<span class="number">-1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qqy[sq[id].d<span class="number">+1</span>+sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>,sq[id].d<span class="number">+1</span>+dis<span class="number">-1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                sq[id].<span class="built_in">Add</span>(-dis,dis);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                qqx[sq[id].b+sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].a,sq[id].a+dis<span class="number">-1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qqx[sq[id].b+sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>,sq[id].c<span class="number">+1</span>+dis<span class="number">-1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qqx[sq[id].d<span class="number">+1</span>+sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].a,sq[id].a+dis<span class="number">-1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qqx[sq[id].d<span class="number">+1</span>+sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>,sq[id].c<span class="number">+1</span>+dis<span class="number">-1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                qqy[sq[id].b+sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].b-dis<span class="number">+1</span>,sq[id].b,<span class="number">1</span>&#125;);</span><br><span class="line">                qqy[sq[id].b+sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].b-dis<span class="number">+1</span>,sq[id].b,<span class="number">-1</span>&#125;);</span><br><span class="line">                qqy[sq[id].d<span class="number">+1</span>+sq[id].a].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>-dis<span class="number">+1</span>,sq[id].d<span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">                qqy[sq[id].d<span class="number">+1</span>+sq[id].c<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].d<span class="number">+1</span>-dis<span class="number">+1</span>,sq[id].d<span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">                sq[id].<span class="built_in">Add</span>(dis,-dis);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">        <span class="type">int</span> id=i;</span><br><span class="line">        qr[sq[id].b].<span class="built_in">pb</span>(&#123;sq[id].a,sq[id].a,<span class="number">1</span>&#125;);</span><br><span class="line">        qr[sq[id].b].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>,sq[id].c<span class="number">+1</span>,<span class="number">-1</span>&#125;);</span><br><span class="line">        qr[sq[id].d<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].a,sq[id].a,<span class="number">-1</span>&#125;);</span><br><span class="line">        qr[sq[id].d<span class="number">+1</span>].<span class="built_in">pb</span>(&#123;sq[id].c<span class="number">+1</span>,sq[id].c<span class="number">+1</span>,<span class="number">1</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// puts(&quot;Finish Prepare&quot;);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,Q)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">        <span class="type">int</span> px,py;<span class="built_in">read</span>(px);<span class="built_in">read</span>(py);</span><br><span class="line">        qur[py].<span class="built_in">pb</span>(&#123;px,<span class="number">-1</span>,i&#125;);quc[px].<span class="built_in">pb</span>(&#123;py,<span class="number">-1</span>,i&#125;);</span><br><span class="line">        qux[py-px+base].<span class="built_in">pb</span>(&#123;px,py,i&#125;);</span><br><span class="line">        quy[px+py].<span class="built_in">pb</span>(&#123;px,py,i&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// puts(&quot;2&quot;);</span></span><br><span class="line">    <span class="comment">// Change There!!!</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*base)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">        <span class="keyword">for</span>(Ques now:qr[i])&#123;</span><br><span class="line">            <span class="comment">// printf(&quot;now.l=%d now.r=%d now.w=%d\n&quot;,now.l,now.r,now.w);</span></span><br><span class="line">            bitx.<span class="built_in">Add</span>(now.l,now.w);</span><br><span class="line">            bitx.<span class="built_in">Add</span>(now.r<span class="number">+1</span>,-now.w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Ques now:qur[i])&#123;</span><br><span class="line">            <span class="comment">// printf(&quot;now.l=%d\n&quot;,now.l);</span></span><br><span class="line">            ans[now.w]+=bitx.<span class="built_in">Ask</span>(<span class="number">1</span>,now.l);</span><br><span class="line">            <span class="comment">// printf(&quot;ans[%d]=%d\n&quot;,now.w,ans[now.w]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// puts(&quot;3&quot;);</span></span><br><span class="line">    <span class="comment">// printf(&quot;ans[2]=%d\n&quot;,ans[2]);</span></span><br><span class="line">    bitx.<span class="built_in">Clear</span>(<span class="number">2</span>*base);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*base)&#123;</span><br><span class="line">        <span class="keyword">for</span>(Ques now:qc[i])&#123;</span><br><span class="line">            <span class="comment">// printf(&quot;now.l=%d now.r=%d now.w=%d\n&quot;,now.l,now.r,now.w);</span></span><br><span class="line">            bitx.<span class="built_in">Add</span>(now.l,now.w);</span><br><span class="line">            bitx.<span class="built_in">Add</span>(now.r<span class="number">+1</span>,-now.w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Ques now:quc[i])&#123;</span><br><span class="line">            <span class="comment">// printf(&quot;now.l=%d\n&quot;,now.l);</span></span><br><span class="line">            ans[now.w]+=bitx.<span class="built_in">Ask</span>(<span class="number">1</span>,now.l);</span><br><span class="line">            <span class="comment">// printf(&quot;ans[%d]=%d\n&quot;,now.w,ans[now.w]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// puts(&quot;4&quot;);</span></span><br><span class="line">    bitx.<span class="built_in">Clear</span>(<span class="number">2</span>*base);</span><br><span class="line">    <span class="comment">// printf(&quot;ans[2]=%d\n&quot;,ans[2]);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*base)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">        <span class="keyword">for</span>(Ques now:qx[i])&#123;</span><br><span class="line">            bitx.<span class="built_in">Add</span>(now.l,now.w);</span><br><span class="line">            bitx.<span class="built_in">Add</span>(now.r<span class="number">+1</span>,-now.w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Ques now:qy[i])&#123;</span><br><span class="line">            bity.<span class="built_in">Add</span>(now.l,now.w);</span><br><span class="line">            bity.<span class="built_in">Add</span>(now.r<span class="number">+1</span>,-now.w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Ques now:qux[i])&#123;</span><br><span class="line">            now.l++;now.r++;</span><br><span class="line">            <span class="type">int</span> nowans=bitx.<span class="built_in">Ask</span>(now.l,<span class="number">2</span>*base)+bity.<span class="built_in">Ask</span>(<span class="number">1</span>,now.r)-bitx.<span class="built_in">Ask</span>(<span class="number">1</span>,now.l<span class="number">-1</span>)-bity.<span class="built_in">Ask</span>(now.r<span class="number">+1</span>,<span class="number">2</span>*base);</span><br><span class="line">            <span class="comment">// assert(nowans%2==0);</span></span><br><span class="line">            ans[now.w]+=(nowans)/<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printf(&quot;ans[1]=%d\n&quot;,ans[1]);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// printf(&quot;ans[2]=%d\n&quot;,ans[2]);</span></span><br><span class="line">    bitx.<span class="built_in">Clear</span>(<span class="number">2</span>*base);bity.<span class="built_in">Clear</span>(<span class="number">2</span>*base);</span><br><span class="line">    <span class="comment">// printf(&quot;ans[2]=%d\n&quot;,ans[2]);</span></span><br><span class="line">    <span class="comment">// puts(&quot;5&quot;);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*base)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">        <span class="keyword">for</span>(Ques now:qqx[i])&#123;</span><br><span class="line">            <span class="comment">// puts(&quot;why1&quot;);</span></span><br><span class="line">            bitx.<span class="built_in">Add</span>(now.l,now.w);</span><br><span class="line">            bitx.<span class="built_in">Add</span>(now.r<span class="number">+1</span>,-now.w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Ques now:qqy[i])&#123;</span><br><span class="line">            <span class="comment">// puts(&quot;why2&quot;);</span></span><br><span class="line">            <span class="comment">// printf(&quot;now.l=%d now.r=%d now.w=%d\n&quot;,now.l,now.r,now.w);</span></span><br><span class="line">            bity.<span class="built_in">Add</span>(now.l,now.w);</span><br><span class="line">            <span class="comment">// puts(&quot;here&quot;);</span></span><br><span class="line">            bity.<span class="built_in">Add</span>(now.r<span class="number">+1</span>,-now.w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(Ques now:quy[i])&#123;</span><br><span class="line">            <span class="comment">// puts(&quot;why&quot;);</span></span><br><span class="line">            <span class="type">int</span> nowans=bitx.<span class="built_in">Ask</span>(<span class="number">1</span>,now.l)+bity.<span class="built_in">Ask</span>(<span class="number">1</span>,now.r)-bitx.<span class="built_in">Ask</span>(now.l<span class="number">+1</span>,<span class="number">2</span>*base)-bity.<span class="built_in">Ask</span>(now.r<span class="number">+1</span>,<span class="number">2</span>*base);</span><br><span class="line">            <span class="comment">// assert(nowans%2==0);</span></span><br><span class="line">            ans[now.w]+=(nowans)/<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printf(&quot;ans[1]=%d\n&quot;,ans[1]);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// puts(&quot;6&quot;);</span></span><br><span class="line">    <span class="comment">// printf(&quot;ans[1]=%d\n&quot;,ans[1]);</span></span><br><span class="line">    <span class="comment">// printf(&quot;ans[2]=%d\n&quot;,ans[2]);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,Q)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1 8 3</span></span><br><span class="line"><span class="comment">2 1 2 1</span></span><br><span class="line"><span class="comment">0 1 1</span></span><br><span class="line"><span class="comment">1 1 1</span></span><br><span class="line"><span class="comment">2 1 1</span></span><br><span class="line"><span class="comment">3 1 1</span></span><br><span class="line"><span class="comment">4 1 1</span></span><br><span class="line"><span class="comment">5 1 1</span></span><br><span class="line"><span class="comment">6 1 1</span></span><br><span class="line"><span class="comment">7 1 1</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">2 1</span></span><br><span class="line"><span class="comment">4 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h1 id="CSPDay1T3"><a href="#CSPDay1T3" class="headerlink" title="CSPDay1T3"></a>CSPDay1T3</h1><p>证明贪心只需要证明移动的话一定不优即可。证明的时候利用代数推导，表示出移动后代价的增量来证明。</p>
<h1 id="CSPDay2T1"><a href="#CSPDay2T1" class="headerlink" title="CSPDay2T1"></a>CSPDay2T1</h1><p>考虑我们只维护值域上的值，放进 $vis$ 中，考虑 $vis$ 中的数不能出现重复，所以最优方案一定是每个位置都是 $1$，所以最优情况是 $1,2,4,8…$，这样 vis 数组每个位置都是 $1$。</p>
<p>所以一旦长度超过 $20$ 是必定有解的。</p>
<h1 id="CSPDay2T3"><a href="#CSPDay2T3" class="headerlink" title="CSPDay2T3"></a>CSPDay2T3</h1><p>其实这个复杂度就和折半搜索，但是奈何我从来没有做过折半搜索。</p>
<p>前 $18$ 和后 $18$ 暴力做，现在变成了在前面选一个数和在后面选一个数的异或和小于等于 $m$，求和的最大值。考虑左右数建出 $01trie$，我们直接在上面 dfs 复杂度就是对的，首先两个数某一位异或值不能大于 $m$ 这一位，其次如果小于，下面走 $0$ 还是 $1$ 就没有限制了，可以预处理 $trie$ 树上每个子树的最大值，这样一次 dfs 的复杂度就应该是 $O(\log m)$ 的。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,m,a[N],b[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Trie</span>&#123;</span><br><span class="line">    <span class="type">int</span> tot,ch[N][<span class="number">2</span>],val[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="title">Trie</span><span class="params">()</span></span>&#123;tot=<span class="number">1</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Insert</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> v)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> p=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dec</span>(i,<span class="number">0</span>,<span class="number">30</span>)&#123;</span><br><span class="line">            <span class="type">int</span> now=(x&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(!ch[p][now])  ch[p][now]=++tot;</span><br><span class="line">            p=ch[p][now];<span class="built_in">cmax</span>(val[p],v);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printf(&quot;tot=%d\n&quot;,tot);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;t1,t2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> op)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> len=r-l<span class="number">+1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">0</span>;s&lt;=(<span class="number">1</span>&lt;&lt;len)<span class="number">-1</span>;s++)&#123;</span><br><span class="line">        <span class="type">int</span> suma=<span class="number">0</span>,sumb=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">0</span>,len<span class="number">-1</span>)<span class="keyword">if</span>((s&gt;&gt;j)&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            suma^=a[j+l];</span><br><span class="line">            sumb+=b[j+l];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(op) t<span class="number">1.</span><span class="built_in">Insert</span>(suma,sumb);</span><br><span class="line">        <span class="keyword">else</span> t<span class="number">2.</span><span class="built_in">Insert</span>(suma,sumb);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> d,<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="comment">// printf(&quot;d=%d x=%d y=%d\n&quot;,d,x,y);</span></span><br><span class="line">    <span class="keyword">if</span>(d==<span class="number">-1</span>)&#123;<span class="keyword">return</span> t<span class="number">1.</span>val[x]+t<span class="number">2.</span>val[y];&#125;</span><br><span class="line">    <span class="type">int</span> now=(m&gt;&gt;d)&amp;<span class="number">1</span>,Ans=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="keyword">if</span>((i^j)&lt;=now&amp;&amp;t<span class="number">1.</span>ch[x][i]&amp;&amp;t<span class="number">2.</span>ch[y][j])&#123;</span><br><span class="line">        <span class="keyword">if</span>((i^j)&lt;now) Ans=<span class="built_in">max</span>(Ans,t<span class="number">1.</span>val[t<span class="number">1.</span>ch[x][i]]+t<span class="number">2.</span>val[t<span class="number">2.</span>ch[y][i]]);</span><br><span class="line">        <span class="keyword">else</span> Ans=<span class="built_in">max</span>(Ans,<span class="built_in">dfs</span>(d<span class="number">-1</span>,t<span class="number">1.</span>ch[x][i],t<span class="number">2.</span>ch[y][j]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// printf(&quot;d=%d x=%d y=%d Ans=%d\n&quot;,d,x,y,Ans);</span></span><br><span class="line">    <span class="keyword">return</span> Ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n);<span class="built_in">read</span>(m);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">read</span>(a[i]);<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">read</span>(b[i]);</span><br><span class="line">    <span class="built_in">Build</span>(<span class="number">1</span>,n/<span class="number">2</span>,<span class="number">1</span>);<span class="built_in">Build</span>(n/<span class="number">2</span><span class="number">+1</span>,n,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// exit(0);</span></span><br><span class="line">    <span class="type">int</span> ans=<span class="built_in">dfs</span>(<span class="number">30</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="NOIPDay2T2"><a href="#NOIPDay2T2" class="headerlink" title="NOIPDay2T2"></a>NOIPDay2T2</h1><p>感觉就很拉格朗日插值，但是没有写。</p>
<p>推式子推到了下面的地方：</p>
<p>$$<br>\begin{aligned}<br>    \sum\limits_{i&#x3D;1}^{k}i^{m+n}-(i-1)^mi^n+(i-1)^ni^m<br>+(i-1)^{m+n}<br>\end{aligned}<br>$$</p>
<p>其实到这里是可以大概推测它是一个 $n+m+1$ 次方的一个多项式，但是严格证明需要把它化成下面的形式：</p>
<p>$$<br>\sum\limits_{i&#x3D;1}^k (i^m-(i-1)^m)(i^n-(i-1)^n)<br>$$</p>
<p>利用第二类斯特林数，可以类似证明自然数幂和多项式次数的方式去证明这个式子的多项式次数。</p>
<p>拉格朗日插值即可。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> mod)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;<span class="keyword">while</span>(b)&#123;<span class="keyword">if</span>(b&amp;<span class="number">1</span>)res=<span class="number">1ll</span>*res*a%mod;a=<span class="number">1ll</span>*a*a%mod;b&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> a)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">ksm</span>(a,mod<span class="number">-2</span>,mod);&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> t,invjie[N],jie[N],x[N],y[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Lag</span><span class="params">(<span class="type">int</span> h,<span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> sum=<span class="number">1</span>;<span class="built_in">rep</span>(i,<span class="number">1</span>,len) sum=sum*(h-x[i])%mod;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,len) x[i]=sum*<span class="built_in">inv</span>(h-x[i])%mod;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,len)&#123;</span><br><span class="line">        ans=(ans+y[i]*x[i]%mod*invjie[i<span class="number">-1</span>]%mod*invjie[len-i]%mod*(((len-i)&amp;<span class="number">1</span>)?(mod<span class="number">-1</span>):<span class="number">1</span>)%mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(t);jie[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">200003</span>) jie[i]=jie[i<span class="number">-1</span>]*i%mod;</span><br><span class="line">    invjie[<span class="number">200003</span>]=<span class="built_in">inv</span>(jie[<span class="number">200003</span>]);</span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">0</span>,<span class="number">200003</span><span class="number">-1</span>) invjie[i]=invjie[i<span class="number">+1</span>]*(i<span class="number">+1</span>)%mod;</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="type">int</span> n,m,k;<span class="built_in">read</span>(n);<span class="built_in">read</span>(m);<span class="built_in">read</span>(k);</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,n+m<span class="number">+2</span>)&#123;</span><br><span class="line">            x[i]=i;y[i]=((<span class="built_in">ksm</span>(i,m,mod)-<span class="built_in">ksm</span>(i<span class="number">-1</span>,m,mod))%mod)*((<span class="built_in">ksm</span>(i,n,mod)-<span class="built_in">ksm</span>(i<span class="number">-1</span>,n,mod))%mod)%mod;</span><br><span class="line">            y[i]=(y[i]+mod)%mod;y[i]=(y[i]+y[i<span class="number">-1</span>])%mod;</span><br><span class="line">            <span class="comment">// printf(&quot;y[%d]=%d\n&quot;,i,y[i]);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(k&lt;=n+m<span class="number">+2</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,y[k]);<span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> ans=<span class="built_in">Lag</span>(k,n+m<span class="number">+2</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="NOIPDay2T3"><a href="#NOIPDay2T3" class="headerlink" title="NOIPDay2T3"></a>NOIPDay2T3</h1><p>赛事想到了 DDP，但是没打，因为从来没有打过 DDP，用 DDP 是两个 $\log$。</p>
<p>一种更好的做法是我们可以考虑树上倍增预处理，DDP 的思路也是我们树剖之后相邻两个区间合并，不如直接树上倍增，复杂度还少一个 $\log$，注意如果一条边有 $3$ 个及以上颜色是可以选的，那么我们就可以认为是这条边一定可以选出一个与两边颜色都不同的一种颜色，我们给这条边打个标记，这样，就可以认为每条边的颜色最多只有 $2$ 中，设 $f_{i,j,0&#x2F;1,0&#x2F;2}$ 表示从 $i$ 往上跳 $2^j$ 步得到的路径中，最上面和最下面的边颜色是什么样的，预处理后直接合并即可。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">map&lt;P,vi &gt;cnt;</span><br><span class="line">map&lt;P,<span class="type">bool</span> &gt;vis;</span><br><span class="line"><span class="type">int</span> n,m,fa[N][<span class="number">21</span>],Q,dep[N];</span><br><span class="line">vc&lt;P&gt; e[N];</span><br><span class="line">array&lt;<span class="type">int</span>,3&gt; f[N][<span class="number">21</span>][<span class="number">2</span>][<span class="number">2</span>],g[<span class="number">2</span>][<span class="number">2</span>],h[<span class="number">2</span>][<span class="number">2</span>],a[<span class="number">2</span>][<span class="number">2</span>],b[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">typedef</span> array&lt;<span class="type">int</span>,3&gt; ar;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Print</span><span class="params">(ar now)</span></span>&#123;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">2</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,now[i]);<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Merge</span><span class="params">(ar a[<span class="number">2</span>][<span class="number">2</span>],ar b[<span class="number">2</span>][<span class="number">2</span>])</span></span>&#123;</span><br><span class="line">    <span class="built_in">mset</span>(g,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(i2,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(j2,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i][j][<span class="number">0</span>]==<span class="number">-1</span>||b[i2][j2][<span class="number">0</span>]==<span class="number">-1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(a[i][j][<span class="number">2</span>]==<span class="number">-3</span>||b[i2][j2][<span class="number">1</span>]==<span class="number">-3</span>)&#123;</span><br><span class="line">            <span class="built_in">cmax</span>(g[i][j2][<span class="number">0</span>],a[i][j][<span class="number">0</span>]+b[i2][j2][<span class="number">0</span>]<span class="number">+1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i][j][<span class="number">2</span>]!=b[i2][j2][<span class="number">1</span>]) <span class="built_in">cmax</span>(g[i][j2][<span class="number">0</span>],a[i][j][<span class="number">0</span>]+b[i2][j2][<span class="number">0</span>]<span class="number">+1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">cmax</span>(g[i][j2][<span class="number">0</span>],a[i][j][<span class="number">0</span>]+b[i2][j2][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        g[i][j2][<span class="number">1</span>]=a[i][j][<span class="number">1</span>];g[i][j2][<span class="number">2</span>]=b[i2][j2][<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// rep(i,0,1)rep(j,0,1)Print(g[i][j]);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> fat)</span></span>&#123;</span><br><span class="line">    dep[k]=dep[fat]<span class="number">+1</span>;</span><br><span class="line">    fa[k][<span class="number">0</span>]=fat;<span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">20</span>) fa[k][i]=fa[fa[k][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">20</span>)&#123;</span><br><span class="line">        <span class="built_in">Merge</span>(f[k][i<span class="number">-1</span>],f[fa[k][i<span class="number">-1</span>]][i<span class="number">-1</span>]);</span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(o,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">            f[k][i][j][o]=g[j][o];</span><br><span class="line">            <span class="comment">// printf(&quot;f[%d][%d][%d][%d]: &quot;,k,i,j,o);</span></span><br><span class="line">            <span class="comment">// Print(f[k][i][j][o]);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(P to:e[k])<span class="keyword">if</span>(to.fi!=fat)&#123;</span><br><span class="line">        vi now=cnt[<span class="built_in">mp</span>(k,to.fi)];</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>((i==<span class="number">1</span>)&amp;&amp;now.<span class="built_in">size</span>()==<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            f[to.fi][<span class="number">0</span>][i][i]=&#123;<span class="number">0</span>,now[i],now[i]&#125;;</span><br><span class="line">            <span class="comment">// printf(&quot;f[%d][%d][%d][%d]: &quot;,to.fi,0,i,i);Print(f[to.fi][0][i][i]);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs</span>(to.fi,k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Ask</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[u]&lt;dep[v]) <span class="built_in">swap</span>(u,v);</span><br><span class="line">    <span class="built_in">mset</span>(a,<span class="number">-1</span>);<span class="built_in">mset</span>(b,<span class="number">-1</span>);</span><br><span class="line">    <span class="type">bool</span> ao=<span class="number">0</span>,bo=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">0</span>,<span class="number">20</span>) <span class="keyword">if</span>(dep[fa[u][i]]&gt;=dep[v])&#123;</span><br><span class="line">        <span class="keyword">if</span>(!ao)&#123;</span><br><span class="line">            <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) a[j][k]=f[u][i][j][k];ao=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">Merge</span>(a,f[u][i]);</span><br><span class="line">            <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) a[j][k]=g[j][k];</span><br><span class="line">        &#125;</span><br><span class="line">        u=fa[u][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(u==v)&#123;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>) h[i][j]=a[i][j];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">0</span>,<span class="number">20</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(fa[u][i]!=fa[v][i])&#123;</span><br><span class="line">            <span class="keyword">if</span>(!ao)&#123;</span><br><span class="line">                <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) a[j][k]=f[u][i][j][k];ao=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">Merge</span>(a,f[u][i]);</span><br><span class="line">                <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) a[j][k]=g[j][k];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!bo)&#123;</span><br><span class="line">                <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) b[j][k]=f[v][i][j][k];</span><br><span class="line">                bo=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">Merge</span>(b,f[v][i]);</span><br><span class="line">                <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) b[j][k]=g[j][k];</span><br><span class="line">            &#125;</span><br><span class="line">            u=fa[u][i];v=fa[v][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!ao)&#123;</span><br><span class="line">        <span class="comment">// puts(&quot;Here&quot;);</span></span><br><span class="line">        <span class="comment">// printf(&quot;u=%d\n&quot;,u);</span></span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">            a[j][k]=f[u][<span class="number">0</span>][j][k];</span><br><span class="line">            <span class="comment">// printf(&quot;f[%d][%d][%d][%d]: &quot;,u,0,j,k);Print(f[u][0][j][k]);</span></span><br><span class="line">        &#125;</span><br><span class="line">        ao=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">Merge</span>(a,f[u][<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) a[j][k]=g[j][k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!bo)&#123;</span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) b[j][k]=f[v][<span class="number">0</span>][j][k];</span><br><span class="line">        bo=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">Merge</span>(b,f[v][<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) b[j][k]=g[j][k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(j,i,<span class="number">1</span>) <span class="built_in">swap</span>(b[i][j],b[j][i]);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">swap</span>(b[i][j][<span class="number">1</span>],b[i][j][<span class="number">2</span>]);</span><br><span class="line">    <span class="comment">// rep(i,0,1)rep(j,0,1)&#123;</span></span><br><span class="line">    <span class="comment">//     printf(&quot;a[%d][%d]: &quot;,i,j);Print(a[i][j]);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// rep(i,0,1)rep(j,0,1)&#123;</span></span><br><span class="line">    <span class="comment">//     printf(&quot;b[%d][%d]: &quot;,i,j);Print(b[i][j]);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="built_in">Merge</span>(a,b);<span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>) h[i][j]=g[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;my.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;my.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">read</span>(n);<span class="built_in">read</span>(m);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,m)&#123;</span><br><span class="line">        <span class="type">int</span> u,v,w;<span class="built_in">read</span>(u);<span class="built_in">read</span>(v);<span class="built_in">read</span>(w);</span><br><span class="line">        vi now=cnt[<span class="built_in">mp</span>(u,v)];</span><br><span class="line">        <span class="keyword">if</span>(!now.<span class="built_in">size</span>())&#123;</span><br><span class="line">            now.<span class="built_in">pb</span>(w);e[u].<span class="built_in">pb</span>(<span class="built_in">mp</span>(v,<span class="number">0</span>));e[v].<span class="built_in">pb</span>(<span class="built_in">mp</span>(u,<span class="number">0</span>));</span><br><span class="line">            cnt[<span class="built_in">mp</span>(u,v)]=cnt[<span class="built_in">mp</span>(v,u)]=now;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">bool</span> op=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> x:now) <span class="keyword">if</span>(x==w)&#123;op=<span class="number">0</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(!op) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(now.<span class="built_in">size</span>()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">                vis[<span class="built_in">mp</span>(u,v)]=vis[<span class="built_in">mp</span>(v,u)]=<span class="number">1</span>;</span><br><span class="line">                now.<span class="built_in">clear</span>();now.<span class="built_in">pb</span>(<span class="number">-3</span>);now.<span class="built_in">pb</span>(<span class="number">-3</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> now.<span class="built_in">pb</span>(w);</span><br><span class="line">            cnt[<span class="built_in">mp</span>(u,v)]=cnt[<span class="built_in">mp</span>(v,u)]=now;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;e[i].<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">        P to=e[i][j];</span><br><span class="line">        <span class="keyword">if</span>(vis[<span class="built_in">mp</span>(i,to.fi)]) e[i][j].se=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">mset</span>(f,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(Q);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,Q)&#123;</span><br><span class="line">        <span class="type">int</span> u,v;<span class="built_in">read</span>(u);<span class="built_in">read</span>(v);</span><br><span class="line">        <span class="keyword">if</span>(u==v)&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">Ask</span>(u,v);</span><br><span class="line">        <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)<span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>)ans=<span class="built_in">max</span>(ans,h[i][j][<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>错误总结：</p>
<ul>
<li>合并写错</li>
</ul>
<h1 id="CSPDay2T4"><a href="#CSPDay2T4" class="headerlink" title="CSPDay2T4"></a>CSPDay2T4</h1><p>考虑设 $y_i&#x3D;k_ix+b_i$，假设 $k_j$ 大于 $0$，需要 $y_i$ 最大，$k_j$ 小于 $0$，需要 $k_j$ 最小。那么我们对于所有的 $x_i$，求出取最大和取最小的直线编号。</p>
<p>有个限制是 $i\not&#x3D;j$，考虑如果把 $i$ 放在外层，那么内层显然要么是次大值，要么是次小值，可以通过扫描线取一下前缀和后缀，解决这个问题。</p>
<p>如果把 $i$ 放在内层，那么需要选一个 $j\not&#x3D;i$ 且 $y_j$ 最大，一样还是前缀和后缀用扫描线扫一下可以解决。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> K[N],B[N],n,Q,x[N],rt,ymax[N],ymin[N],cymx[N],cymi[N],ans[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LCT</span>&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls(k) p[k].ls</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs(k) p[k].rs</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> F(id,x) K[id]*(x)+B[id]</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">        <span class="type">int</span> ls,rs,mx,mi;</span><br><span class="line">    &#125;p[N];</span><br><span class="line">    <span class="type">int</span> tot;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="title">LCT</span><span class="params">()</span></span>&#123;tot=<span class="number">0</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ChangeMin</span><span class="params">(<span class="type">int</span> &amp;k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> z,<span class="type">int</span> y,<span class="type">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!k)&#123;k=++tot;<span class="built_in">assert</span>(tot&lt;=N<span class="number">-1</span>);&#125;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;<span class="keyword">if</span>(!p[k].mi||<span class="built_in">F</span>(p[k].mi,l)&gt;<span class="built_in">F</span>(id,l)) p[k].mi=id;<span class="keyword">return</span>;&#125;<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!p[k].mi) p[k].mi=id;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">F</span>(p[k].mi,mid)&gt;<span class="built_in">F</span>(id,mid)) <span class="built_in">swap</span>(p[k].mi,id);</span><br><span class="line">            (<span class="built_in">F</span>(id,l)&lt;<span class="built_in">F</span>(p[k].mi,l))?<span class="built_in">ChangeMin</span>(<span class="built_in">ls</span>(k),l,mid,z,y,id):<span class="built_in">ChangeMin</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,z,y,id);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=mid) <span class="built_in">ChangeMin</span>(<span class="built_in">ls</span>(k),l,mid,z,y,id);<span class="keyword">if</span>(mid&lt;y) <span class="built_in">ChangeMin</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,z,y,id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ChangeMax</span><span class="params">(<span class="type">int</span> &amp;k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> z,<span class="type">int</span> y,<span class="type">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!k)&#123;k=++tot;&#125;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;<span class="keyword">if</span>(!p[k].mx||<span class="built_in">F</span>(p[k].mx,l)&lt;<span class="built_in">F</span>(id,l)) p[k].mx=id;<span class="keyword">return</span>;&#125;<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!p[k].mx) p[k].mx=id;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">F</span>(p[k].mx,mid)&lt;<span class="built_in">F</span>(id,mid)) <span class="built_in">swap</span>(p[k].mx,id);</span><br><span class="line">            (<span class="built_in">F</span>(id,l)&gt;<span class="built_in">F</span>(p[k].mx,l))?<span class="built_in">ChangeMax</span>(<span class="built_in">ls</span>(k),l,mid,z,y,id):<span class="built_in">ChangeMax</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,z,y,id);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=mid) <span class="built_in">ChangeMax</span>(<span class="built_in">ls</span>(k),l,mid,z,y,id);<span class="keyword">if</span>(mid&lt;y) <span class="built_in">ChangeMax</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,z,y,id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Change</span><span class="params">(<span class="type">int</span> &amp;k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> z,<span class="type">int</span> y,<span class="type">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="built_in">ChangeMin</span>(k,l,r,z,y,id);<span class="built_in">ChangeMax</span>(k,l,r,z,y,id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">AskMin</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> w)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!k) <span class="keyword">return</span> <span class="number">0</span>;<span class="keyword">if</span>(l==r) <span class="keyword">return</span> p[k].mi;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;<span class="type">int</span> id=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(w&lt;=mid) id=<span class="built_in">AskMin</span>(<span class="built_in">ls</span>(k),l,mid,w);<span class="keyword">else</span> id=<span class="built_in">AskMin</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,w);</span><br><span class="line">        <span class="keyword">if</span>(id==<span class="number">0</span>) <span class="keyword">return</span> p[k].mi;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">F</span>(id,w)&lt;<span class="built_in">F</span>(p[k].mi,w))?id:p[k].mi;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">AskMax</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> w)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!k) <span class="keyword">return</span> <span class="number">0</span>;<span class="keyword">if</span>(l==r) <span class="keyword">return</span> p[k].mx;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;<span class="type">int</span> id=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(w&lt;=mid) id=<span class="built_in">AskMax</span>(<span class="built_in">ls</span>(k),l,mid,w);<span class="keyword">else</span> id=<span class="built_in">AskMax</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,w);</span><br><span class="line">        <span class="keyword">if</span>(id==<span class="number">0</span>) <span class="keyword">return</span> p[k].mx;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">F</span>(id,w)&gt;<span class="built_in">F</span>(p[k].mx,w))?id:p[k].mx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Clear</span><span class="params">()</span></span>&#123;<span class="built_in">mset</span>(p,<span class="number">0</span>);rt=<span class="number">0</span>;tot=<span class="number">0</span>;&#125;</span><br><span class="line">&#125;st;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Ques</span>&#123;</span><br><span class="line">    <span class="type">int</span> id,w;</span><br><span class="line">&#125;;</span><br><span class="line">vc&lt;Ques&gt; qmx[N],qmi[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;my.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;my.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="built_in">read</span>(K[i]);<span class="built_in">read</span>(B[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">read</span>(Q);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,Q) <span class="built_in">read</span>(x[i]);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        st.<span class="built_in">Change</span>(rt,-Len,Len,-Len,Len,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// exit(0);</span></span><br><span class="line">    <span class="comment">//插入所有的直线</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,Q)&#123;</span><br><span class="line">        ymax[i]=st.<span class="built_in">AskMax</span>(rt,-Len,Len,x[i]);</span><br><span class="line">        ymin[i]=st.<span class="built_in">AskMin</span>(rt,-Len,Len,x[i]);</span><br><span class="line">        <span class="comment">// qmx[ymax[i]].pb(&#123;i,F(ymax[i],x[i])&#125;);</span></span><br><span class="line">        <span class="comment">// qmx[ymin[i]].pb(&#123;i,F(ymin[i],x[i])&#125;);</span></span><br><span class="line">        qmx[ymax[i]].<span class="built_in">pb</span>(&#123;i,x[i]&#125;);</span><br><span class="line">        qmi[ymin[i]].<span class="built_in">pb</span>(&#123;i,x[i]&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    st.<span class="built_in">Clear</span>();</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i!=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Ques now:qmx[i])&#123;</span><br><span class="line">                <span class="type">int</span> id=st.<span class="built_in">AskMax</span>(rt,-Len,Len,now.w);</span><br><span class="line">                <span class="keyword">if</span>(!cymx[now.id]||<span class="built_in">F</span>(cymx[now.id],x[now.id])&lt;<span class="built_in">F</span>(id,x[now.id])) cymx[now.id]=id;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(Ques now:qmi[i])&#123;</span><br><span class="line">                <span class="type">int</span> id=st.<span class="built_in">AskMin</span>(rt,-Len,Len,now.w);</span><br><span class="line">                <span class="keyword">if</span>(!cymi[now.id]||<span class="built_in">F</span>(cymi[now.id],x[now.id])&gt;<span class="built_in">F</span>(id,x[now.id])) cymi[now.id]=id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        st.<span class="built_in">Change</span>(rt,-Len,Len,-Len,Len,i);</span><br><span class="line">    &#125;</span><br><span class="line">    st.<span class="built_in">Clear</span>();</span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i!=n)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Ques now:qmx[i])&#123;</span><br><span class="line">                <span class="type">int</span> id=st.<span class="built_in">AskMax</span>(rt,-Len,Len,now.w);</span><br><span class="line">                <span class="keyword">if</span>(!cymx[now.id]||<span class="built_in">F</span>(cymx[now.id],x[now.id])&lt;<span class="built_in">F</span>(id,x[now.id])) cymx[now.id]=id;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(Ques now:qmi[i])&#123;</span><br><span class="line">                <span class="type">int</span> id=st.<span class="built_in">AskMin</span>(rt,-Len,Len,now.w);</span><br><span class="line">                <span class="comment">// printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">                <span class="comment">// printf(&quot;id=%d\n&quot;,id);</span></span><br><span class="line">                <span class="keyword">if</span>(!cymi[now.id]||<span class="built_in">F</span>(cymi[now.id],x[now.id])&gt;<span class="built_in">F</span>(id,x[now.id])) cymi[now.id]=id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        st.<span class="built_in">Change</span>(rt,-Len,Len,-Len,Len,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//对于每个 x[i] 维护好了 取到次大值和次小值的直线 id。</span></span><br><span class="line">    <span class="comment">// rep(i,1,Q)&#123;</span></span><br><span class="line">    <span class="comment">//     printf(&quot;x[%d]=%d ymax[%d]=%d ymin[%d]=%d cymx[%d]=%d cymi[%d]=%d\n&quot;,i,x[i],i,ymax[i],i,ymin[i],i,cymx[i],i,cymi[i]);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,Q)&#123;</span><br><span class="line">        ans[i]=-INF;</span><br><span class="line">        <span class="built_in">cmax</span>(ans[i],<span class="built_in">max</span>(<span class="built_in">F</span>(ymax[i],<span class="built_in">F</span>(cymx[i],x[i])),<span class="built_in">F</span>(ymin[i],<span class="built_in">F</span>(cymi[i],x[i]))));</span><br><span class="line">        <span class="keyword">if</span>(ymax[i]!=cymi[i]) <span class="built_in">cmax</span>(ans[i],<span class="built_in">F</span>(ymax[i],<span class="built_in">F</span>(cymi[i],x[i])));</span><br><span class="line">        <span class="keyword">if</span>(ymin[i]!=cymx[i]) <span class="built_in">cmax</span>(ans[i],<span class="built_in">F</span>(ymin[i],<span class="built_in">F</span>(cymx[i],x[i])));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//在 yi 作为外层时的答案。</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        qmx[i].<span class="built_in">clear</span>();qmi[i].<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,Q)&#123;</span><br><span class="line">        qmx[ymax[i]].<span class="built_in">pb</span>(&#123;i,<span class="built_in">F</span>(ymax[i],x[i])&#125;);</span><br><span class="line">        qmx[ymin[i]].<span class="built_in">pb</span>(&#123;i,<span class="built_in">F</span>(ymin[i],x[i])&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    st.<span class="built_in">Clear</span>();</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i!=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Ques now:qmx[i])&#123;</span><br><span class="line">                <span class="type">int</span> id=st.<span class="built_in">AskMax</span>(rt,-Len,Len,now.w);</span><br><span class="line">                <span class="keyword">if</span>(id) <span class="built_in">cmax</span>(ans[now.id],<span class="built_in">F</span>(id,now.w));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        st.<span class="built_in">Change</span>(rt,-Len,Len,-Len,Len,i);</span><br><span class="line">    &#125;</span><br><span class="line">    st.<span class="built_in">Clear</span>();</span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i!=n)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Ques now:qmx[i])&#123;</span><br><span class="line">                <span class="type">int</span> id=st.<span class="built_in">AskMax</span>(rt,-Len,Len,now.w);</span><br><span class="line">                <span class="keyword">if</span>(id) <span class="built_in">cmax</span>(ans[now.id],<span class="built_in">F</span>(id,now.w));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        st.<span class="built_in">Change</span>(rt,-Len,Len,-Len,Len,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,Q)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>错误总结：</p>
<ul>
<li>主席树写Change写错</li>
<li>n,q 写反了</li>
</ul>
<h1 id="CSPDay3T4"><a href="#CSPDay3T4" class="headerlink" title="CSPDay3T4"></a>CSPDay3T4</h1><p>博弈，考虑角色一定是一个追一个跑，且不难发现跑的那个是一定要走到两个点满足追的那个都是走不到的才能弄到平局。有了这个观察之后就好写很多。</p>
<h1 id="NOIPDay3T2"><a href="#NOIPDay3T2" class="headerlink" title="NOIPDay3T2"></a>NOIPDay3T2</h1><p>首先有一个 naive 的贪心，但是不难发现难以处理点权相同的情况，所以答案不仅和值有关，还和输的形态有关，贪心不行，提示我们想动态规划。</p>
<p>不难发现我们只需要知道自己与父亲的连边究竟是小于等于自己还是大于自己即可，于是可以设 $f_{k,0&#x2F;1}$ 表示自己与父亲之间的边是小于等于 $a_k$ 还是大于 $a_k$，转移的时候对于每个点预处理出 $w_{to,0&#x2F;1}$ 表示这条边的权值小于 $a_{k}$ 还是大于 $a_k$，以及贡献是多少，一开始认为趋势 $w_{to,0}$，然后作差排序，贪心选择即可。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,m,a[N],ans,f[N][<span class="number">2</span>],w[N][<span class="number">2</span>];</span><br><span class="line">vi e[N],v;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="comment">// if(k==64469)&#123;</span></span><br><span class="line">    <span class="comment">//     assert(0);</span></span><br><span class="line">    <span class="comment">//     // printf(&quot;k=%d fa=%d\n&quot;,k,fa);</span></span><br><span class="line">    <span class="comment">//     assert(0);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// if(k==51462) printf(&quot;k=%d fa=%d\n&quot;,k,fa);</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> to:e[k])&#123;</span><br><span class="line">        <span class="comment">// if(k==51462) printf(&quot;to=%d\n&quot;,to);</span></span><br><span class="line">        <span class="keyword">if</span>(to!=fa)&#123;</span><br><span class="line">            <span class="comment">// if(k==51462) printf(&quot;to=/d\n&quot;,to);</span></span><br><span class="line">            <span class="built_in">dfs</span>(to,k);</span><br><span class="line">            <span class="comment">// puts(&quot;Now&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if(k==51462) puts(&quot;Here&quot;);</span></span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;v.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> to:e[k]) <span class="keyword">if</span>(to!=fa)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[to]&lt;a[k])&#123;</span><br><span class="line">            w[to][<span class="number">0</span>]=<span class="built_in">max</span>(f[to][<span class="number">0</span>]+a[to],f[to][<span class="number">1</span>]+a[k]);</span><br><span class="line">            w[to][<span class="number">1</span>]=f[to][<span class="number">1</span>]+m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a[to]==a[k])&#123;</span><br><span class="line">            w[to][<span class="number">0</span>]=f[to][<span class="number">0</span>]+a[k];</span><br><span class="line">            w[to][<span class="number">1</span>]=f[to][<span class="number">1</span>]+m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            w[to][<span class="number">0</span>]=f[to][<span class="number">0</span>]+a[k];</span><br><span class="line">            w[to][<span class="number">1</span>]=<span class="built_in">max</span>(f[to][<span class="number">1</span>]+m,f[to][<span class="number">0</span>]+a[to]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printf(&quot;w[%d][1]=%d w[%d][0]=%d\n&quot;,to,w[to][1],to,w[to][0]);</span></span><br><span class="line">        v.<span class="built_in">pb</span>(w[to][<span class="number">1</span>]-w[to][<span class="number">0</span>]);</span><br><span class="line">        sum+=w[to][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>(),[&amp;](<span class="type">int</span> i,<span class="type">int</span> j)&#123;<span class="keyword">return</span> i&gt;j;&#125;);</span><br><span class="line">    <span class="comment">// if(k==51462) puts(&quot;here&quot;);</span></span><br><span class="line">    f[k][<span class="number">0</span>]=f[k][<span class="number">1</span>]=sum;</span><br><span class="line">    <span class="keyword">if</span>(v.<span class="built_in">size</span>()) <span class="built_in">rep</span>(i,<span class="number">0</span>,((<span class="type">int</span>)v.<span class="built_in">size</span>())/<span class="number">2</span><span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="comment">// if(k==51462) printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">        <span class="keyword">if</span>(v[i]&gt;<span class="number">0</span>) f[k][<span class="number">0</span>]+=v[i];<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(v.<span class="built_in">size</span>()) <span class="built_in">rep</span>(i,<span class="number">0</span>,((<span class="type">int</span>)v.<span class="built_in">size</span>())/<span class="number">2</span><span class="number">-2</span>)&#123;</span><br><span class="line">        <span class="comment">// if(k==51462) printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line">        <span class="keyword">if</span>(v[i]&gt;<span class="number">0</span>) f[k][<span class="number">1</span>]+=v[i];<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if(k==51462) puts(&quot;Here&quot;);</span></span><br><span class="line">    <span class="keyword">if</span>(!v.<span class="built_in">size</span>())&#123;</span><br><span class="line">        f[k][<span class="number">1</span>]=-INF;f[k][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(a[k]==m&amp;&amp;k!=<span class="number">1</span>)&#123;</span><br><span class="line">        f[k][<span class="number">1</span>]=-INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(e[k].<span class="built_in">size</span>()&lt;=<span class="number">2</span>&amp;&amp;k!=<span class="number">1</span>)&#123;</span><br><span class="line">        f[k][<span class="number">1</span>]=-INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// printf(&quot;f[%d][0]=%d f[%d][1]=%d\n&quot;,k,f[k][0],k,f[k][1]);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n);<span class="built_in">read</span>(m);<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="comment">// printf(&quot;a[90]=%d a[63]=%d\n&quot;,a[90],a[63]);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="type">int</span> u,v;<span class="built_in">read</span>(u);<span class="built_in">read</span>(v);e[u].<span class="built_in">pb</span>(v);e[v].<span class="built_in">pb</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(e[<span class="number">1</span>].<span class="built_in">size</span>()&amp;<span class="number">1</span>) ans=f[<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        ans=f[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// ans=max(f[1][0],f[1][1]);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不过这份代码大样例 RE 的情况下居然过了。</p>
<h1 id="NOIPDay3T3"><a href="#NOIPDay3T3" class="headerlink" title="NOIPDay3T3"></a>NOIPDay3T3</h1><p>考虑如果钦定 $a_i$ 一定在答案中，那么答案一定是其一个约数，所以我们可以枚举所有它的约数，然后算一下狄利克雷前缀和，来计算其每一个约数出现了多少次，选满足条件的最大的即可。</p>
<p>考虑题目保证要选择 $\frac{n+1}{2}$ 上取整的数字，所以随机一个数其满足条件的概率是 $\frac{1}{2}$，于是可以多随机几次。</p>
<p>注意狄利克雷前缀和怎么做，我们实际上是之关注约数上的值，所以没有必要处理处所有的质数，只需要处理出那些能给约数之间带来转移的质数，换句话说，也就是在这些约数中出现过的质数，即当前枚举值的所有质因子。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">mt19937 <span class="title">rnd</span><span class="params">(time(<span class="number">0</span>)+time(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="type">int</span> d[N],f[N],n,a[N];</span><br><span class="line"><span class="type">bool</span> no[N];</span><br><span class="line">vi v,p;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;<span class="keyword">return</span> b==<span class="number">0</span>?a:<span class="built_in">gcd</span>(b,a%b);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Calc</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> X=x;</span><br><span class="line">    v.<span class="built_in">clear</span>();<span class="type">int</span> i;p.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>;i*i&lt;x;i++)<span class="keyword">if</span>(x%i==<span class="number">0</span>)&#123;</span><br><span class="line">        v.<span class="built_in">pb</span>(i);v.<span class="built_in">pb</span>(x/i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(i*i==x) v.<span class="built_in">pb</span>(i);</span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>());</span><br><span class="line">    <span class="built_in">fill</span>(f,f+v.<span class="built_in">size</span>(),<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">2</span>;i*i&lt;=x;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(x%i==<span class="number">0</span>)&#123;</span><br><span class="line">            p.<span class="built_in">pb</span>(i);<span class="keyword">while</span>(x%i==<span class="number">0</span>) x/=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x!=<span class="number">1</span>) p.<span class="built_in">pb</span>(x);</span><br><span class="line">    <span class="comment">// puts(&quot;v:&quot;);for(int x:v) printf(&quot;%d &quot;,x);puts(&quot;&quot;);</span></span><br><span class="line">    <span class="comment">// puts(&quot;p:&quot;);for(int x:p) printf(&quot;%d &quot;,x);puts(&quot;&quot;);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="type">int</span> g=<span class="built_in">gcd</span>(a[i],X);</span><br><span class="line">        <span class="comment">// printf(&quot;a[i]=%d X=%d g=%d\n&quot;,a[i],X,g);</span></span><br><span class="line">        f[<span class="built_in">lower_bound</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>(),g)-v.<span class="built_in">begin</span>()]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// rep(i,0,(int)v.size()-1) printf(&quot;f[%d]=%d\n&quot;,i,f[i]);</span></span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> now:p)&#123;</span><br><span class="line">        <span class="built_in">dec</span>(i,<span class="number">1</span>,(<span class="type">int</span>)v.<span class="built_in">size</span>()<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(v[i]%now==<span class="number">0</span>)&#123;</span><br><span class="line">                f[<span class="built_in">lower_bound</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>(),v[i]/now)-v.<span class="built_in">begin</span>()]+=f[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// rep(i,0,(int)v.size()-1) printf(&quot;f[%d]=%d\n&quot;,i,f[i]);</span></span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">0</span>,(<span class="type">int</span>)v.<span class="built_in">size</span>()<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(f[i]&gt;=(n<span class="number">+1</span>)/<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="comment">// printf(&quot;v[%d]=%d\n&quot;,i,v[i]);</span></span><br><span class="line">            <span class="keyword">return</span> v[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n);<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="built_in">shuffle</span>(a<span class="number">+1</span>,a+n<span class="number">+1</span>,rnd);</span><br><span class="line">    <span class="type">int</span> Ans=-INF;</span><br><span class="line">    <span class="comment">// puts(&quot;a:&quot;);rep(i,1,n) printf(&quot;%d &quot;,a[i]);puts(&quot;&quot;);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="built_in">min</span>(n,<span class="number">12ll</span>))&#123;</span><br><span class="line">        Ans=<span class="built_in">max</span>(Ans,<span class="built_in">Calc</span>(a[i]));</span><br><span class="line">        <span class="comment">// printf(&quot;i=%d Ans=%d\n&quot;,i,Ans);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,Ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>犯的错误：</p>
<ul>
<li>$x$ 处理质数的时候被消成 $1$，忘记拷贝副本。（可以通过多谢函数来解决）。</li>
</ul>
<h1 id="NOIPDay3T4"><a href="#NOIPDay3T4" class="headerlink" title="NOIPDay3T4"></a>NOIPDay3T4</h1><p><a target="_blank" rel="noopener" href="https://loj.ac/problem/3276">原题链接</a></p>
<p>一个非常有难度的 DP。</p>
<p>首先考虑我们怎么做这个 DP，首先如果每个位置上的值都知道，在值域上从大到小考虑显然是一个优美的选择，但是现在每个位置上的值都不知道，这就很让人头疼。因为限制在后面，我们考虑从后往前 DP。设 $f_{i,j}$ 表示考虑 $i,n$ 中的每一个数，整个过程中我们相当于要维护一个集合，集合里的每一个数都相当于这个数有没有出现过。考虑我们新加进去一个数 $x$，那么这个数最终会变成距离其最近的一个小于它的没有出现过的位置对应的数，而如果不存在这样的一个位置，说明这个数最终会变成 $0$，我们状态中的 $j$ 记录的就是这个集合中的最长的出现过的数字的前缀长度。同时，我们认为两个相同的数字是不同的，这样方便我们处理，这样做每一个方案都会被算重 $2^n$， 除掉即可。</p>
<p>接下来考虑转移。首先我们维护一个 $Cnt_b$ 和 $Cnt_p$ 表示到目前为止所有变成 $0$ 的数和所有没变成 $0$ 的数字。</p>
<p>假如当前位置是一个要变成 $0$ 的位置，那么考虑我们在这个位置上放的数一定是 $1$ 到 $j$ 中的数，且我们分析一下，这样的数一共有 $2j$ 个，$1$ 到 $j$ 都出现过了，这需要恰好 $j$ 个，而前面又有 $Cnt_b$ 个变成 $0$ 的位置，这些位置上放的数一定也是 $1$ 到 $j$，所以我们的转移系数应该是 $2j-j-Cnt_b&#x3D;j-Cnt_b$。</p>
<p>假如当前位置不是一个要变成 $0$ 的位置，那么这是比较难办的，其中的一个原因是我们没有存下来这个集合。那我们不妨这样做：我们只考虑前 $[1,j]$ 的方案数，而不考虑其它的方案数。其余的方案数等 $j$ 变化的时候再考虑。</p>
<p>如果这个位置不会变成 $0$，那么其放的数一定是 $\ge j+1$，考虑如果放了一个数最后不会变成 $j+1$，那么 $j$ 不会变化，有 $f_{i,j}+&#x3D;f_{i+1,j}$。</p>
<p>否则，那么 $j$ 会变化，设变成 $j+k$，那么我们这个数一定是在 $[j+1,j+k]$ 种选择，如果选择 $j+1$ 的话，一共是有两种选择，因为 $j+1$ 以前是从来没有选过的。否则的话，因为其余位置都出现过，所以 $[j+2,j+k]$ 这个区间中只有 $k-1$ 种选择，所以总的方案数是 $k+1$。</p>
<p>还需要考虑后面这 $k-1$ 个出现过的数字是怎么出来的，首先要在所有的没变成 $0$ 的位置上把它们选出来，因为我们已经考虑了前 $j$ 个的位置，所以有一个 $\binom{Cnt_p-j}{k-1}$ 的系数。其次，我们还有一个方案，就是在 $k-1$ 个位置中填 $k-1$ 个数，组成了连续的一段被选择的数，设这一段的方案数为 $G_{k-1}$。</p>
<p>考虑如何求 $G_{k-1}$。设 $g_{i,j}$ 表示考虑了 $1,i$ 这 $i$ 种数，可以不用，最后组成了 $1,j$ 这样一个前缀的方案数。那么考虑转移，首先第 $i$ 种数可以不用或者不做贡献，那就是一个 $g_{i-1,j}$，注意我们只考虑做贡献的数字的方案数。其次，如果其做的贡献为 $1$ 的话，那么可以在当前的序列的任何位置加一个数，且因为两个相同大小的数认为不同，所以加的数有两种选择，系数是 $2j$。最后考虑两个数都做贡献，那么就是随便插入，系数是 $(j-1)j$，这样就做完了。</p>
<p>讲的可能不清晰，推一篇讲的巨清晰的<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dysyn1314/p/12877113.html">博客</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mset(a,b) memset((a),(b),sizeof((a)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,l,r) for(int i=(l);i&lt;=(r);i++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dec(i,l,r) for(int i=(r);i&gt;=(l);i--)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cmax(a,b) (((a)&lt;(b))?(a=b):(a))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cmin(a,b) (((a)&gt;(b))?(a=b):(a))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Next(k) for(int x=head[k];x;x=li[x].next)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> vc vector</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ar array</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pi pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 2010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M number</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> dd;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">double</span> ld;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> uint;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; P;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="type">int</span>&gt; vi;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> dd eps=<span class="number">1e-9</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span> </span>&#123;</span><br><span class="line">    x=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> c=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">for</span>(;!<span class="built_in">isdigit</span>(c);c=<span class="built_in">getchar</span>()) <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) f=-f;</span><br><span class="line">    <span class="keyword">for</span>(;<span class="built_in">isdigit</span>(c);c=<span class="built_in">getchar</span>()) x=x*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    x*=f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,g[N][N],jie[N],invjie[N],f[N][N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> mod)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;<span class="keyword">while</span>(b)&#123;<span class="keyword">if</span>(b&amp;<span class="number">1</span>)res=<span class="number">1ll</span>*res*a%mod;a=<span class="number">1ll</span>*a*a%mod;b&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">ksm</span>(x,mod<span class="number">-2</span>,mod);&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">C</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;m) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// printf(&quot;n=%d m=%d ans=%d\n&quot;,n,m,jie[n]*invjie[m]%mod*invjie[n-m]%mod);</span></span><br><span class="line">    <span class="keyword">return</span> jie[n]*invjie[m]%mod*invjie[n-m]%mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="type">int</span> x;<span class="built_in">read</span>(x);vis[x]=<span class="number">1</span>;</span><br><span class="line">    &#125;g[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">0</span>,i)&#123;</span><br><span class="line">            g[i][j]=g[i<span class="number">-1</span>][j];</span><br><span class="line">            <span class="keyword">if</span>(j) g[i][j]=(g[i][j]+g[i<span class="number">-1</span>][j<span class="number">-1</span>]*<span class="number">2</span>*j%mod)%mod;</span><br><span class="line">            <span class="keyword">if</span>(j&gt;<span class="number">1</span>) g[i][j]=(g[i][j]+g[i<span class="number">-1</span>][j<span class="number">-2</span>]*(j<span class="number">-1</span>)*j%mod)%mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    jie[<span class="number">0</span>]=<span class="number">1</span>;<span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*n) jie[i]=jie[i<span class="number">-1</span>]*i%mod;invjie[<span class="number">2</span>*n]=<span class="built_in">inv</span>(jie[<span class="number">2</span>*n]);</span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">0</span>,<span class="number">2</span>*n<span class="number">-1</span>) invjie[i]=invjie[i<span class="number">+1</span>]*(i<span class="number">+1</span>)%mod;</span><br><span class="line">    f[<span class="number">2</span>*n<span class="number">+1</span>][<span class="number">0</span>]=<span class="number">1</span>;<span class="type">int</span> CntBreak=<span class="number">0</span>,CntProtect=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">1</span>,<span class="number">2</span>*n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(vis[i])&#123;</span><br><span class="line">            <span class="built_in">rep</span>(j,<span class="number">0</span>,CntProtect) <span class="keyword">if</span>(f[i<span class="number">+1</span>][j])&#123;</span><br><span class="line">                f[i][j]=(f[i][j]+f[i<span class="number">+1</span>][j])%mod;</span><br><span class="line">                <span class="built_in">rep</span>(k,<span class="number">1</span>,CntProtect<span class="number">+1</span>)&#123;</span><br><span class="line">                    f[i][k+j]=(f[i][k+j]+f[i<span class="number">+1</span>][j]*(k<span class="number">+1</span>)%mod*<span class="built_in">C</span>(CntProtect-j,k<span class="number">-1</span>)%mod*g[k<span class="number">-1</span>][k<span class="number">-1</span>]%mod)%mod;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            CntProtect++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">rep</span>(j,CntBreak<span class="number">+1</span>,CntProtect) f[i][j]=(f[i][j]+f[i<span class="number">+1</span>][j]*(j-CntBreak)%mod)%mod;</span><br><span class="line">            CntBreak++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// rep(j,0,n) printf(&quot;f[%d][%d]=%d\n&quot;,i,j,f[i][j]);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=f[<span class="number">1</span>][n]*<span class="built_in">inv</span>(<span class="built_in">ksm</span>(<span class="number">2</span>,n,mod))%mod;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>HYLTianMeng</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E6%95%B0%E8%AE%BA/"># 数论</a>
                    
                        <a href="/tags/%E8%B4%AA%E5%BF%83/"># 贪心</a>
                    
                        <a href="/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F/"># 多项式</a>
                    
                        <a href="/tags/%E6%89%AB%E6%8F%8F%E7%BA%BF/"># 扫描线</a>
                    
                        <a href="/tags/%E6%90%9C%E7%B4%A2/"># 搜索</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/10/01/%E6%88%91%E4%BB%AC%E5%88%9A%E5%88%9A%E7%9F%A5%E9%81%93%E9%82%A3%E4%BA%9B%E9%A2%98%E7%9A%84%E8%A7%A3%E6%B3%95-4/">我们刚刚知道那些题的解法#4</a>
            
            
            <a class="next" rel="next" href="/2022/09/15/%E6%88%91%E4%BB%AC%E5%88%9A%E5%88%9A%E7%9F%A5%E9%81%93%E9%82%A3%E4%BA%9B%E9%A2%98%E7%9A%84%E8%A7%A3%E6%B3%95-2/">我们刚刚知道那些题的解法#2</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© HYLTianMeng | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>
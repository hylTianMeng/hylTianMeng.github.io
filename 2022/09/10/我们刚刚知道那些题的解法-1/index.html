<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="HYLTianMeng">





<title>我们刚刚知道那些题的解法#1 | HYL&#39;s BLog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
            <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">HYL&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">HYL&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">我们刚刚知道那些题的解法#1</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">HYLTianMeng</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">September 10, 2022&nbsp;&nbsp;20:03:10</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">做题记录</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="P7735"><a href="#P7735" class="headerlink" title="P7735"></a>P7735</h1><p>考虑将一条边的贡献记在深度较大的电上，一次修改要改的点太多。</p>
<p>想到如果维护每个点的时间，那么一条边是实边当且仅当两个点的时间相同。</p>
<p>轻重链剖分，对于一次操作，维护每个节点的时间，维护重链上的所有点的点权。</p>
<p>对于一次询问，重边直接把贡献加起来，轻边考虑询问两边的时间，因为轻边个数只有 $\log n$ 个，所以复杂度是对的。</p>
<p>复杂度 $O(n\log ^2n)$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SegmentTree ST</span></span><br><span class="line"><span class="keyword">namespace</span> SegmentTree&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls(k) k&lt;&lt;1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs(k) k&lt;&lt;1|1</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">        <span class="type">int</span> col,val,sum,tcv,tcc,len;</span><br><span class="line">    &#125;p[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Cc</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> co)</span></span>&#123;</span><br><span class="line">        p[k].col=co;p[k].tcc=co;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Cv</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> va)</span></span>&#123;</span><br><span class="line">        p[k].val=va;p[k].tcv=va;</span><br><span class="line">        p[k].sum=va*p[k].len;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">PushDown</span><span class="params">(<span class="type">int</span> k)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(p[k].tcc)&#123;<span class="built_in">Cc</span>(<span class="built_in">ls</span>(k),p[k].tcc);<span class="built_in">Cc</span>(<span class="built_in">rs</span>(k),p[k].tcc);p[k].tcc=<span class="number">0</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(p[k].tcv!=<span class="number">-1</span>)&#123;<span class="built_in">Cv</span>(<span class="built_in">ls</span>(k),p[k].tcv);<span class="built_in">Cv</span>(<span class="built_in">rs</span>(k),p[k].tcv);p[k].tcv=<span class="number">-1</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">PushUp</span><span class="params">(<span class="type">int</span> k)</span></span>&#123;p[k].sum=p[<span class="built_in">ls</span>(k)].sum+p[<span class="built_in">rs</span>(k)].sum;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ChangeV</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> z,<span class="type">int</span> y,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=l&amp;&amp;r&lt;=y)&#123;<span class="built_in">Cv</span>(k,x);<span class="keyword">return</span>;&#125;<span class="built_in">PushDown</span>(k);<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=mid) <span class="built_in">ChangeV</span>(<span class="built_in">ls</span>(k),l,mid,z,y,x);</span><br><span class="line">        <span class="keyword">if</span>(mid&lt;y) <span class="built_in">ChangeV</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,z,y,x);<span class="built_in">PushUp</span>(k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ChangeC</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> z,<span class="type">int</span> y,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=l&amp;&amp;r&lt;=y)&#123;<span class="built_in">Cc</span>(k,x);<span class="keyword">return</span>;&#125;<span class="built_in">PushDown</span>(k);<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=mid) <span class="built_in">ChangeC</span>(<span class="built_in">ls</span>(k),l,mid,z,y,x);</span><br><span class="line">        <span class="keyword">if</span>(mid&lt;y) <span class="built_in">ChangeC</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,z,y,x);<span class="built_in">PushUp</span>(k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Build</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">        p[k].tcv=<span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;p[k].len=r-l<span class="number">+1</span>;<span class="keyword">if</span>(l==r) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">Build</span>(<span class="built_in">ls</span>(k),l,mid);<span class="built_in">Build</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ask</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> z,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=l&amp;&amp;r&lt;=y) <span class="keyword">return</span> p[k].sum;<span class="built_in">PushDown</span>(k);<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(z&lt;=mid) ans+=<span class="built_in">Ask</span>(<span class="built_in">ls</span>(k),l,mid,z,y);</span><br><span class="line">        <span class="keyword">if</span>(mid&lt;y) ans+=<span class="built_in">Ask</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,z,y);<span class="built_in">PushUp</span>(k);<span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Gc</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> w)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r) <span class="keyword">return</span> p[k].col;<span class="built_in">PushDown</span>(k);<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(w&lt;=mid) <span class="keyword">return</span> <span class="built_in">Gc</span>(<span class="built_in">ls</span>(k),l,mid,w);<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">Gc</span>(<span class="built_in">rs</span>(k),mid<span class="number">+1</span>,r,w);<span class="built_in">PushUp</span>(k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Clear</span><span class="params">()</span></span>&#123;<span class="built_in">mset</span>(p,<span class="number">0</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> t,n,m,id[N],rk[N],tot,fa[N],son[N],siz[N],dep[N],top[N];</span><br><span class="line">vi e[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> fat)</span></span>&#123;</span><br><span class="line">    dep[k]=dep[fat]<span class="number">+1</span>;fa[k]=fat;siz[k]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> to:e[k]) <span class="keyword">if</span>(to!=fat)&#123;<span class="built_in">dfs</span>(to,k);siz[k]+=siz[to];<span class="keyword">if</span>(siz[son[k]]&lt;siz[to]) son[k]=to;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> t)</span></span>&#123;</span><br><span class="line">    id[k]=++tot;rk[tot]=k;top[k]=t;<span class="keyword">if</span>(son[k]) <span class="built_in">Dfs</span>(son[k],t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> to:e[k]) <span class="keyword">if</span>(to!=son[k]&amp;&amp;to!=fa[k]) <span class="built_in">Dfs</span>(to,to);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ST::<span class="built_in">Clear</span>();<span class="built_in">rep</span>(i,<span class="number">1</span>,n) e[i].<span class="built_in">clear</span>(),id[i]=rk[i]=fa[i]=son[i]=siz[i]=dep[i]=top[i]=<span class="number">0</span>;tot=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Change</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> A=a,B=b,l=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[a]!=top[b])&#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[a]]&lt;dep[top[b]]) <span class="built_in">swap</span>(a,b);</span><br><span class="line">        ST::<span class="built_in">ChangeC</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[top[a]],id[a],v);</span><br><span class="line">        <span class="keyword">if</span>(top[a]!=a) ST::<span class="built_in">ChangeV</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[top[a]]],id[a],<span class="number">1</span>);</span><br><span class="line">        a=fa[top[a]];</span><br><span class="line">        <span class="keyword">if</span>(son[a]) ST::<span class="built_in">ChangeV</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[a]],id[son[a]],<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dep[a]&lt;dep[b]) <span class="built_in">swap</span>(a,b);l=b;</span><br><span class="line">    <span class="keyword">if</span>(l==B)&#123;<span class="keyword">if</span>(son[A]) ST::<span class="built_in">ChangeV</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[A]],id[son[A]],<span class="number">0</span>);&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(l==A)&#123;<span class="keyword">if</span>(son[B]) ST::<span class="built_in">ChangeV</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[B]],id[son[B]],<span class="number">0</span>);&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="keyword">if</span>(son[A]) ST::<span class="built_in">ChangeV</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[A]],id[son[A]],<span class="number">0</span>);<span class="keyword">if</span>(son[B]) ST::<span class="built_in">ChangeV</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[B]],id[son[B]],<span class="number">0</span>);&#125;</span><br><span class="line">    <span class="comment">// printf(&quot;son[A]=%d\n&quot;,son[A]);</span></span><br><span class="line">    <span class="comment">// printf(&quot;son[B]=%d\n&quot;,son[B]);</span></span><br><span class="line">    <span class="comment">// printf(&quot;Ask(5)=%d\n&quot;,ST::Ask(1,1,n,id[5],id[5]));</span></span><br><span class="line">    <span class="comment">// printf(&quot;id[%d]=%d id[%d]=%d\n&quot;,b,id[b],a,id[a]);</span></span><br><span class="line">    ST::<span class="built_in">ChangeC</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[b],id[a],v);</span><br><span class="line">    <span class="keyword">if</span>(a!=b) ST::<span class="built_in">ChangeV</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[b]],id[a],<span class="number">1</span>);</span><br><span class="line">    ST::<span class="built_in">ChangeV</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[b],id[b],<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// printf(&quot;Ask(5)=%d\n&quot;,ST::Ask(1,1,n,id[5],id[5]));</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ask</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> Ans=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">// printf(&quot;Ask(2)=%d Ask(7)=%d\n&quot;,ST::Ask(1,1,n,id[2],id[2]),ST::Ask(1,1,n,id[7],id[7]));</span></span><br><span class="line">    <span class="comment">// printf(&quot;Ask(5)=%d\n&quot;,ST::Ask(1,1,n,id[5],id[5]));</span></span><br><span class="line">    <span class="keyword">while</span>(top[a]!=top[b])&#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[a]]&lt;dep[top[b]]) <span class="built_in">swap</span>(a,b);</span><br><span class="line">        <span class="keyword">if</span>(a!=top[a]) Ans+=ST::<span class="built_in">Ask</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[top[a]]],id[a]);</span><br><span class="line">        <span class="type">int</span> t=top[a];a=fa[top[a]];</span><br><span class="line">        <span class="type">int</span> c1=ST::<span class="built_in">Gc</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[t]),c2=ST::<span class="built_in">Gc</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[a]);</span><br><span class="line">        <span class="keyword">if</span>(c1==c2&amp;&amp;c1!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">// puts(&quot;here&quot;);</span></span><br><span class="line">            Ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// printf(&quot;Ans=%d\n&quot;,Ans);</span></span><br><span class="line">    <span class="keyword">if</span>(dep[a]&lt;dep[b]) <span class="built_in">swap</span>(a,b);</span><br><span class="line">    <span class="keyword">if</span>(a!=b) Ans+=ST::<span class="built_in">Ask</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[son[b]],id[a]);</span><br><span class="line">    <span class="keyword">return</span> Ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(t);</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;t=%d\n&quot;,t);</span></span><br><span class="line">        <span class="built_in">read</span>(n);<span class="built_in">read</span>(m);</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,n<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="type">int</span> u,v;<span class="built_in">read</span>(u);<span class="built_in">read</span>(v);e[u].<span class="built_in">pb</span>(v);e[v].<span class="built_in">pb</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">        ST::<span class="built_in">Build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);<span class="built_in">Dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// rep(i,1,n) printf(&quot;son[%d]=%d\n&quot;,i,son[i]);</span></span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,m)&#123;</span><br><span class="line">            <span class="type">int</span> op,a,b;<span class="built_in">read</span>(op);<span class="built_in">read</span>(a);<span class="built_in">read</span>(b);</span><br><span class="line">            <span class="keyword">if</span>(op==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">Change</span>(a,b,i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">Ask</span>(a,b));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">Clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>犯的错误：</p>
<ul>
<li>多测不清空。</li>
<li>跳重链的时候忘记修改儿子。</li>
<li>下传标记覆盖没有注意到 $0$。</li>
<li>讨论初始点儿子的修改出错。</li>
</ul>
<p>改进：</p>
<ul>
<li>调试之前先沉住气把代码整体阅读一遍，可以省下很多时间。</li>
</ul>
<h1 id="P7736"><a href="#P7736" class="headerlink" title="P7736"></a>P7736</h1><p>考虑 $k&#x3D;2$ 不难发现答案就是邻接矩阵的行列式。</p>
<p>这是因为对于路径 $(i,p_i)$，$p$ 是一个排列，而交点个数的奇偶性等同于排列的奇偶性。这提示我们往行列式的方向去想。</p>
<p>考虑 $k&gt;2$，但是 $n_i&#x3D;n_1$。设 $n_i,n_{i+1}$ 组成的邻接矩阵为 $M_i$，考虑 $\prod |M_i|$ 的结果，不难发现就是问题的答案。这是因为考虑合并两个邻接矩阵 $|M_i||M_{i+1}|$，相当于 $(\sum(-1)^{\mathbb{sgn(p)}})(\sum(-1)^{\mathbb{sgn(q)}})$，正好相当于奇偶性的一个合并。</p>
<p>考虑一般情况，注意到上面的那种情况同样也可以写成 $|\prod M_i|&#x3D;|M|$，而邻接矩阵的乘法是有意义的，$M_{i,j}$ 就表示第一层图的 $i$ 到第 $k$ 层图的 $j$ 的方案数是多少。考虑一般情况下的 $|M|$，合并两个邻接矩阵，方案的奇偶性不变，所以 $|M|$ 奇偶性的部分是正确的，考虑路径是否可能有交，假设两条路径有交，起点终点分别为 $x_i&lt;x_j,y_i&lt;y_j$，那么合并之后 $(x_i,y_i),(x_j,y_j)$ 是不合法的，但是与之对应的，$(x_i,y_j),(x_j,y_i)$ 是一条交点个数与上面奇偶性不同的一条路径，所以恰好容斥掉了。</p>
<p>所以答案就是相邻邻接矩阵乘积的行列式。</p>
<p>复杂度为 $O(kn^2+n^3\log n)$。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> mod)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;<span class="keyword">while</span>(b)&#123;<span class="keyword">if</span>(b&amp;<span class="number">1</span>)&#123;res=<span class="number">1ll</span>*res*a%mod;&#125;a=<span class="number">1ll</span>*a*a%mod;b&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">ksm</span>(x,mod<span class="number">-2</span>,mod);&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Matrix</span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m,a[N][N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Clear</span><span class="params">()</span></span>&#123;<span class="built_in">mset</span>(a,<span class="number">0</span>);n=m=<span class="number">0</span>;&#125;</span><br><span class="line">    <span class="keyword">inline</span> Matrix <span class="keyword">operator</span> * (<span class="type">const</span> Matrix &amp;b)<span class="type">const</span>&#123;</span><br><span class="line">        <span class="built_in">assert</span>(m==b.n);</span><br><span class="line">        Matrix c;c.<span class="built_in">Clear</span>();c.n=n;c.m=b.m;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,c.n)<span class="built_in">rep</span>(j,<span class="number">1</span>,c.m)<span class="built_in">rep</span>(k,<span class="number">1</span>,m)&#123;</span><br><span class="line">            c.a[i][j]=(c.a[i][j]+a[i][k]*b.a[k][j]%mod)%mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">            <span class="built_in">rep</span>(j,<span class="number">1</span>,m) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[i][j]);</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Det</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">assert</span>(n==m);</span><br><span class="line">        <span class="type">int</span> x=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,n)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!a[i][i])&#123;</span><br><span class="line">                <span class="built_in">rep</span>(j,i<span class="number">+1</span>,n) <span class="keyword">if</span>(a[j][i])&#123;</span><br><span class="line">                    <span class="built_in">rep</span>(k,<span class="number">1</span>,n) <span class="built_in">swap</span>(a[j][k],a[i][k]);</span><br><span class="line">                    x*=<span class="number">-1</span>;<span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!a[i][i]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> nowinv=<span class="built_in">inv</span>(a[i][i]);</span><br><span class="line">            <span class="built_in">rep</span>(j,i<span class="number">+1</span>,n)&#123;</span><br><span class="line">                <span class="type">int</span> K=a[j][i]*nowinv%mod;</span><br><span class="line">                <span class="built_in">rep</span>(k,<span class="number">1</span>,n) a[j][k]=((a[j][k]-K*a[i][k]%mod)%mod+mod)%mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// (*this).Print();</span></span><br><span class="line">        <span class="type">int</span> ans=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,n) ans=ans*a[i][i]%mod;<span class="keyword">return</span> (ans*x%mod+mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> t,n[N],m[N],K;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(t);</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="built_in">read</span>(K);</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,K) <span class="built_in">read</span>(n[i]);<span class="built_in">rep</span>(i,<span class="number">1</span>,K<span class="number">-1</span>) <span class="built_in">read</span>(m[i]);</span><br><span class="line">        Matrix A;A.<span class="built_in">Clear</span>();A.n=n[<span class="number">1</span>];A.m=n[<span class="number">1</span>];<span class="built_in">rep</span>(i,<span class="number">1</span>,A.n) A.a[i][i]=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,K<span class="number">-1</span>)&#123;</span><br><span class="line">            Matrix B;B.<span class="built_in">Clear</span>();</span><br><span class="line">            <span class="built_in">rep</span>(j,<span class="number">1</span>,m[i])&#123;</span><br><span class="line">                <span class="type">int</span> u,v;<span class="built_in">read</span>(u);<span class="built_in">read</span>(v);</span><br><span class="line">                B.a[u][v]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            B.n=n[i];B.m=n[i<span class="number">+1</span>];</span><br><span class="line">            <span class="comment">// B.Print();</span></span><br><span class="line">            A=A*B;</span><br><span class="line">            <span class="comment">// A.Print();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,A.<span class="built_in">Det</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>犯的错误:</p>
<ul>
<li>高斯消元忘记换一个不为 $0$ 的行上来。</li>
<li>空间开小。</li>
</ul>
<h1 id="P7913"><a href="#P7913" class="headerlink" title="P7913"></a>P7913</h1><p>首先想到三分，但是显然是假的。</p>
<p>考虑能否处理出 $f_i$ 表示国内放 $i$ 个桥的最优值是多少，容易想到一个桥对应的那些区间一定是不交的区间，而且如果新加入一个桥，对以前的桥没有影响，我们可以看做是在还没选的区间里新选一些无交的区间，其中没选的区间的第一个区间是一定要选的。</p>
<h1 id="P7915"><a href="#P7915" class="headerlink" title="P7915"></a>P7915</h1><p>选一个数后，在另一个也是这个数的位置标号，表示在最后的区间中这个数应该在哪里。比如 <code>1234155324</code>，选了第一个 $1$ 之后再第二个 $1$ 上标 $10$。</p>
<p>首先考虑我们需要保证前 $n$ 个数是一个排列，且对于标为 $k$ 的数往左往右至少有一边小于 $k$。也就是说，对于一种合法方案，设已经标号的区间为 $[z,y]$，假设我们接下来要选的数为 $k$，那么一定要保证 $z-1,y+1$ 这两个位置其中一个为 $k$。</p>
<p>同时，注意到在左右都可以选的情况下先选左边和先选右边不影响情况的合法性。所以贪心即可。</p>
<p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> t,a[N],n,st,b[N];</span><br><span class="line">P p[N];</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Check</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> z,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="comment">// puts(&quot;Here&quot;);</span></span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*n) b[i]=<span class="number">0</span>;</span><br><span class="line">    b[z]=<span class="number">2</span>*n;</span><br><span class="line">    <span class="keyword">while</span>(y-z<span class="number">+1</span>&lt;n)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;l=%d r=%d\n&quot;,l,r);</span></span><br><span class="line">        <span class="comment">// printf(&quot;p[a[l]].se=%d\n&quot;,p[a[l]].se);</span></span><br><span class="line">        <span class="keyword">while</span>(!b[l]&amp;&amp;(p[a[l]].se==z<span class="number">-1</span>||p[a[l]].se==y<span class="number">+1</span>)&amp;&amp;y-z<span class="number">+1</span>&lt;n)&#123;</span><br><span class="line">            cnt++;</span><br><span class="line">            <span class="keyword">if</span>(p[a[l]].se==z<span class="number">-1</span>) z--,b[z]=<span class="number">2</span>*n-cnt<span class="number">+1</span>;<span class="keyword">else</span> y++,b[y]=<span class="number">2</span>*n-cnt<span class="number">+1</span>;</span><br><span class="line">            s[++st]=<span class="string">&#x27;L&#x27;</span>;l++;</span><br><span class="line">            <span class="comment">// puts(&quot;L&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(y-z<span class="number">+1</span>&gt;=n) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span>(!b[r]&amp;&amp;(p[a[r]].fi==z<span class="number">-1</span>||p[a[r]].fi==y<span class="number">+1</span>))&#123;</span><br><span class="line">            cnt++;</span><br><span class="line">            <span class="keyword">if</span>(p[a[r]].fi==z<span class="number">-1</span>) z--,b[z]=<span class="number">2</span>*n-cnt<span class="number">+1</span>;<span class="keyword">else</span> y++,b[y]=<span class="number">2</span>*n-cnt<span class="number">+1</span>;</span><br><span class="line">            s[++st]=<span class="string">&#x27;R&#x27;</span>;r--;</span><br><span class="line">            <span class="comment">// puts(&quot;R&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// rep(i,1,2*n) printf(&quot;%d &quot;,b[i]);</span></span><br><span class="line">    <span class="type">int</span> now=n<span class="number">+1</span>;</span><br><span class="line">    <span class="keyword">while</span>(z&lt;=y)&#123;</span><br><span class="line">        <span class="keyword">if</span>(b[z]==now) s[++st]=<span class="string">&#x27;L&#x27;</span>,z++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(b[y]==now) s[++st]=<span class="string">&#x27;R&#x27;</span>,y--;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">assert</span>(<span class="number">0</span>);</span><br><span class="line">        now++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,st) <span class="built_in">putchar</span>(s[i]);<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;my.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;my.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">read</span>(t);</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="built_in">read</span>(n);</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*n) <span class="built_in">read</span>(a[i]);</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*n) p[a[i]]=<span class="built_in">mp</span>(<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">2</span>*n)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p[a[i]].fi==<span class="number">-1</span>)&#123;p[a[i]].fi=i;&#125;<span class="keyword">else</span> p[a[i]].se=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">bool</span> op=<span class="number">0</span>;</span><br><span class="line">        st=<span class="number">0</span>;s[++st]=<span class="string">&#x27;L&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Check</span>(<span class="number">2</span>,<span class="number">2</span>*n,p[a[<span class="number">1</span>]].se,p[a[<span class="number">1</span>]].se))&#123;op=<span class="number">1</span>;<span class="built_in">Print</span>();<span class="keyword">continue</span>;&#125;</span><br><span class="line">        st=<span class="number">0</span>;s[++st]=<span class="string">&#x27;R&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Check</span>(<span class="number">1</span>,<span class="number">2</span>*n<span class="number">-1</span>,p[a[<span class="number">2</span>*n]].fi,p[a[<span class="number">2</span>*n]].fi))&#123;op=<span class="number">1</span>;<span class="built_in">Print</span>();<span class="keyword">continue</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(!op)&#123;<span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="P7914"><a href="#P7914" class="headerlink" title="P7914"></a>P7914</h1><p>显然是一个区间 DP，设 $f_{l,r}$ 表示一个合法超级括号序列，设 $A$ 是具有 $(C)$ 形式的合法超级括号序列，其中 $C$ 为任意字符串，$S$ 如题意所示，$B$ 是合法括号序列，那么 $f_{l,r}$ 有以下部分组成：</p>
<ul>
<li>$\text{ASB}$</li>
<li>$\text{AB}$</li>
<li>$\text{A}$</li>
</ul>
<p>设 $g_{l,r}$ 表示 $AS$ 的个数，$h{l,r}$ 表示 $A$ 的个数。</p>
<p>考虑计算 $h_{l,r}$，不难发现其由以下部分组成：</p>
<ul>
<li>$\text{(B)}$</li>
<li>$\text{(S)}$</li>
<li>$\text{(SB)}$</li>
<li>$\text{(BS)}$</li>
</ul>
<p>枚举 $S$ 的长度转移即可。</p>
<p>考虑计算 $g_{l,r}$，直接枚举 $S$ 长度即可。</p>
<p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> f[N][N],g[N][N][<span class="number">2</span>],h[N][N],n,K;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n);<span class="built_in">read</span>(K);<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s<span class="number">+1</span>);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>((s[i]==<span class="string">&#x27;(&#x27;</span>||s[i]==<span class="string">&#x27;?&#x27;</span>)&amp;&amp;(s[i<span class="number">+1</span>]==<span class="string">&#x27;)&#x27;</span>||s[i<span class="number">+1</span>]==<span class="string">&#x27;?&#x27;</span>))&#123;</span><br><span class="line">            f[i][i<span class="number">+1</span>]=h[i][i<span class="number">+1</span>]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">3</span>,n)&#123;</span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">1</span>,n-i<span class="number">+1</span>)&#123;</span><br><span class="line">            <span class="type">int</span> l=j,r=j+i<span class="number">-1</span>;</span><br><span class="line">            <span class="comment">// rep(k,1,K)&#123;</span></span><br><span class="line">            <span class="comment">//     if(s[l+k-1]!=&#x27;*&#x27;&amp;&amp;s[l+k-1]!=&#x27;?&#x27;) break;</span></span><br><span class="line">            <span class="comment">//     if(l+k-1&gt;=r-1) break;</span></span><br><span class="line">            <span class="comment">//     g[l][r][0]=(g[l][r][0]+h[l+k][r])%mod;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="built_in">rep</span>(k,<span class="number">1</span>,K)&#123;</span><br><span class="line">                <span class="keyword">if</span>(s[r-k<span class="number">+1</span>]!=<span class="string">&#x27;*&#x27;</span>&amp;&amp;s[r-k<span class="number">+1</span>]!=<span class="string">&#x27;?&#x27;</span>) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span>(l<span class="number">+1</span>&gt;=r-k<span class="number">+1</span>) <span class="keyword">break</span>;</span><br><span class="line">                g[l][r][<span class="number">1</span>]=(g[l][r][<span class="number">1</span>]+h[l][r-k])%mod;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(s[l]!=<span class="string">&#x27;*&#x27;</span>&amp;&amp;s[l]!=<span class="string">&#x27;)&#x27;</span>&amp;&amp;s[r]!=<span class="string">&#x27;*&#x27;</span>&amp;&amp;s[r]!=<span class="string">&#x27;(&#x27;</span>)&#123;</span><br><span class="line">                <span class="type">int</span> L=l<span class="number">+1</span>,R=r<span class="number">-1</span>;</span><br><span class="line">                <span class="type">bool</span> op=<span class="number">1</span>;</span><br><span class="line">                <span class="built_in">rep</span>(k,L,R) <span class="keyword">if</span>(s[k]!=<span class="string">&#x27;*&#x27;</span>&amp;&amp;s[k]!=<span class="string">&#x27;?&#x27;</span>)&#123;op=<span class="number">0</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">                <span class="keyword">if</span>(R-L<span class="number">+1</span>&lt;=K&amp;&amp;op) h[l][r]++;</span><br><span class="line">                h[l][r]=(h[l][r]+f[L][R])%mod;</span><br><span class="line">                <span class="built_in">rep</span>(k,L,R<span class="number">-1</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(s[k]!=<span class="string">&#x27;*&#x27;</span>&amp;&amp;s[k]!=<span class="string">&#x27;?&#x27;</span>) <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">if</span>(k-L<span class="number">+1</span>&gt;K) <span class="keyword">break</span>;</span><br><span class="line">                    h[l][r]=(h[l][r]+f[k<span class="number">+1</span>][R])%mod;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">dec</span>(k,L<span class="number">+1</span>,R)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(s[k]!=<span class="string">&#x27;*&#x27;</span>&amp;&amp;s[k]!=<span class="string">&#x27;?&#x27;</span>) <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">if</span>(R-k<span class="number">+1</span>&gt;K) <span class="keyword">break</span>;</span><br><span class="line">                    h[l][r]=(h[l][r]+f[L][k<span class="number">-1</span>])%mod;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> h[l][r]=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">rep</span>(k,l,r<span class="number">-1</span>)&#123;</span><br><span class="line">                f[l][r]=(f[l][r]<span class="number">+1ll</span>*g[l][k][<span class="number">1</span>]*f[k<span class="number">+1</span>][r]%mod)%mod;</span><br><span class="line">                f[l][r]=(f[l][r]<span class="number">+1ll</span>*h[l][k]*f[k<span class="number">+1</span>][r]%mod)%mod;</span><br><span class="line">            &#125;</span><br><span class="line">            f[l][r]=(f[l][r]+h[l][r])%mod;</span><br><span class="line">            <span class="comment">// printf(&quot;g[l][r][1]=%d h[l][r]=%d f[l][r]=%d l=%d r=%d\n&quot;,g[l][r][1],h[l][r],f[l][r],l,r);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,f[<span class="number">1</span>][n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="P7916"><a href="#P7916" class="headerlink" title="P7916"></a>P7916</h1><p>参考<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/105254/solution-p7916"> Piwry 的博客</a></p>
<p>首先显然有一个最小割的模型，但是网络流时间复杂度不够优。考虑网格图为平面图，而 $k&#x3D;2$ 的时候可以利用平面图转对偶图，考虑如何扩展到一般情况。</p>
<p>利用同样的思路，先建出原图的对偶图，考虑我们只需要考虑那些相邻不用颜色附加点之间的点，把这些点两两配对即可。容易想到路径是不会相交的，如果相交，改变配对的方式，一定不会比原先的方案劣，所以我们只需要建出对偶图，然后跑最短路，最后做一个 DP 去求解最优配对方案即可，做 DP 的时候记得有路径不交的限制。</p>
<p>注意，相邻相同颜色附加点之间的点也是有意义的，可能会出现以下情况：</p>
<p><img src="https://pic.imgdb.cn/item/6311b7ed16f2c2beb1f357cb.png"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vc&lt;P&gt; e[N*N];</span><br><span class="line"><span class="type">int</span> c[N][N],r[N][N],n,m,T,d[N*N],f[N][N],xu[N*N],cnt[N*N],w[N][N];</span><br><span class="line"><span class="type">bool</span> vis[N*N];</span><br><span class="line">vi v;</span><br><span class="line">P id[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    <span class="type">int</span> w,id,co;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Point &amp;b)<span class="type">const</span>&#123;<span class="keyword">return</span> id&lt;b.id;&#125;</span><br><span class="line">&#125;p[N*N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ID</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a<span class="number">-1</span>)*(m<span class="number">-1</span>)+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">    <span class="type">int</span> id,v;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Node &amp;b)<span class="type">const</span>&#123;<span class="keyword">return</span> v&gt;b.v;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">priority_queue&lt;Node&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dij</span><span class="params">(<span class="type">int</span> id,<span class="type">int</span> s)</span></span>&#123;</span><br><span class="line">    <span class="built_in">fill</span>(d<span class="number">+1</span>,d<span class="number">+1000</span>*<span class="number">1000</span><span class="number">+1</span>,INF);q.<span class="built_in">push</span>(&#123;s,<span class="number">0</span>&#125;);d[s]=<span class="number">0</span>;<span class="built_in">mset</span>(vis,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        Node top=q.<span class="built_in">top</span>();q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(vis[top.id]) <span class="keyword">continue</span>;</span><br><span class="line">        vis[top.id]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(P to:e[top.id])&#123;</span><br><span class="line">            <span class="keyword">if</span>(vis[to.fi]||d[to.fi]&lt;=d[top.id]+to.se) <span class="keyword">continue</span>;</span><br><span class="line">            d[to.fi]=d[top.id]+to.se;</span><br><span class="line">            q.<span class="built_in">push</span>(&#123;to.fi,d[to.fi]&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;(<span class="type">int</span>)v.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;w[%d][%d=%d\n&quot;,i,id,d[v[i]]);</span></span><br><span class="line">        w[id][i]=w[i][id]=d[v[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Print</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    <span class="comment">// printf(&quot;from=%lld to=%lld w=%lld\n&quot;,a,b,c);</span></span><br><span class="line">    cnt[a]++;cnt[b]++;</span><br><span class="line">    <span class="built_in">assert</span>(cnt[a]&lt;=e[a].<span class="built_in">size</span>());</span><br><span class="line">    <span class="built_in">assert</span>(cnt[b]&lt;=e[b].<span class="built_in">size</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout); </span></span><br><span class="line">    <span class="built_in">read</span>(n);<span class="built_in">read</span>(m);<span class="built_in">read</span>(T);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n<span class="number">-1</span>)<span class="built_in">rep</span>(j,<span class="number">1</span>,m)&#123;</span><br><span class="line">        <span class="built_in">read</span>(c[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n)<span class="built_in">rep</span>(j,<span class="number">1</span>,m<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">read</span>(r[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n<span class="number">-2</span>)<span class="built_in">rep</span>(j,<span class="number">1</span>,m<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="comment">// Print(ID(i,j),ID(i+1,j),r[i+1][j]);</span></span><br><span class="line">        e[<span class="built_in">ID</span>(i,j)].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="built_in">ID</span>(i<span class="number">+1</span>,j),r[i<span class="number">+1</span>][j]));</span><br><span class="line">        e[<span class="built_in">ID</span>(i<span class="number">+1</span>,j)].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="built_in">ID</span>(i,j),r[i<span class="number">+1</span>][j]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// puts(&quot;Finish colu&quot;);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n<span class="number">-1</span>)<span class="built_in">rep</span>(j,<span class="number">1</span>,m<span class="number">-2</span>)&#123;</span><br><span class="line">        <span class="comment">// Print(ID(i,j),ID(i,j+1),c[i][j+1]);</span></span><br><span class="line">        e[<span class="built_in">ID</span>(i,j)].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="built_in">ID</span>(i,j<span class="number">+1</span>),c[i][j<span class="number">+1</span>]));</span><br><span class="line">        e[<span class="built_in">ID</span>(i,j<span class="number">+1</span>)].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="built_in">ID</span>(i,j),c[i][j<span class="number">+1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,m<span class="number">-1</span>) id[i]=<span class="built_in">mp</span>(<span class="number">1</span>,i);id[m]=<span class="built_in">mp</span>(<span class="number">-1</span>,<span class="number">-1</span>);<span class="built_in">rep</span>(i,m<span class="number">+1</span>,m+n<span class="number">-1</span>) id[i]=<span class="built_in">mp</span>(i-m,m<span class="number">-1</span>);id[m+n]=<span class="built_in">mp</span>(<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">rep</span>(i,m+n<span class="number">+1</span>,<span class="number">2</span>*m+n<span class="number">-1</span>) id[i]=<span class="built_in">mp</span>(n<span class="number">-1</span>,<span class="number">2</span>*m+n-i);id[<span class="number">2</span>*m+n]=<span class="built_in">mp</span>(<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">2</span>*m+n<span class="number">+1</span>,<span class="number">2</span>*m<span class="number">+2</span>*n<span class="number">-1</span>) id[i]=<span class="built_in">mp</span>(<span class="number">2</span>*m<span class="number">+2</span>*n-i,<span class="number">1</span>);id[<span class="number">2</span>*m<span class="number">+2</span>*n]=<span class="built_in">mp</span>(<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="comment">// puts(&quot;Finish&quot;);</span></span><br><span class="line">    <span class="comment">//矩形内部建边。</span></span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="comment">// printf(&quot;T=%d\n&quot;,T);</span></span><br><span class="line">        <span class="type">int</span> pc;<span class="built_in">read</span>(pc);</span><br><span class="line">        <span class="keyword">if</span>(pc==<span class="number">1</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">continue</span>;&#125;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,pc)&#123;</span><br><span class="line">            <span class="type">int</span> w,id,co;<span class="built_in">read</span>(w);<span class="built_in">read</span>(id);<span class="built_in">read</span>(co);</span><br><span class="line">            p[i].w=w;p[i].id=id;p[i].co=co;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(p<span class="number">+1</span>,p+pc<span class="number">+1</span>);</span><br><span class="line">        <span class="type">int</span> tot=<span class="built_in">ID</span>(n<span class="number">-1</span>,m<span class="number">-1</span>);</span><br><span class="line">        v.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">2</span>,pc)&#123;</span><br><span class="line">            <span class="comment">// printf(&quot;i=%lld\n&quot;,i);</span></span><br><span class="line">            ++tot;</span><br><span class="line">            <span class="built_in">rep</span>(j,p[i<span class="number">-1</span>].id,p[i].id<span class="number">-1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(id[j]==<span class="built_in">mp</span>(<span class="number">-1ll</span>,<span class="number">-1ll</span>)) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> w=<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">if</span>(j&lt;=m)&#123;w=r[id[j].fi][id[j].se];&#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=m+n)&#123;w=c[id[j].fi][id[j].se<span class="number">+1</span>];&#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=<span class="number">2</span>*m+n)&#123;w=r[id[j].fi<span class="number">+1</span>][id[j].se];&#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=<span class="number">2</span>*m<span class="number">+2</span>*n)&#123;w=c[id[j].fi][id[j].se];&#125;</span><br><span class="line">                e[tot].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="built_in">ID</span>(id[j].fi,id[j].se),w));</span><br><span class="line">                e[<span class="built_in">ID</span>(id[j].fi,id[j].se)].<span class="built_in">pb</span>(<span class="built_in">mp</span>(tot,w));</span><br><span class="line">                <span class="built_in">Print</span>(tot,<span class="built_in">ID</span>(id[j].fi,id[j].se),w);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i!=<span class="number">2</span>)&#123;</span><br><span class="line">                e[tot].<span class="built_in">pb</span>(<span class="built_in">mp</span>(tot<span class="number">-1</span>,p[i<span class="number">-1</span>].w));</span><br><span class="line">                e[tot<span class="number">-1</span>].<span class="built_in">pb</span>(<span class="built_in">mp</span>(tot,p[i<span class="number">-1</span>].w));</span><br><span class="line">                <span class="built_in">Print</span>(tot,tot<span class="number">-1</span>,p[i<span class="number">-1</span>].w);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(p[i].co!=p[i<span class="number">-1</span>].co) v.<span class="built_in">pb</span>(tot);</span><br><span class="line">        &#125;</span><br><span class="line">        ++tot;</span><br><span class="line">        e[tot<span class="number">-1</span>].<span class="built_in">pb</span>(<span class="built_in">mp</span>(tot,p[pc].w));</span><br><span class="line">        e[tot].<span class="built_in">pb</span>(<span class="built_in">mp</span>(tot<span class="number">-1</span>,p[pc].w));</span><br><span class="line">        <span class="built_in">Print</span>(tot<span class="number">-1</span>,tot,p[pc].w);</span><br><span class="line">        <span class="built_in">rep</span>(j,p[pc].id,<span class="number">2</span>*m<span class="number">+2</span>*n)&#123;</span><br><span class="line">            <span class="keyword">if</span>(id[j]==<span class="built_in">mp</span>(<span class="number">-1ll</span>,<span class="number">-1ll</span>)) <span class="keyword">continue</span>; </span><br><span class="line">            <span class="type">int</span> w=<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span>(j&lt;=m)&#123;w=r[id[j].fi][id[j].se];&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=m+n)&#123;w=c[id[j].fi][id[j].se<span class="number">+1</span>];&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=<span class="number">2</span>*m+n)&#123;w=r[id[j].fi<span class="number">+1</span>][id[j].se];&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=<span class="number">2</span>*m<span class="number">+2</span>*n)&#123;w=c[id[j].fi][id[j].se];&#125;</span><br><span class="line">            <span class="comment">// printf(&quot;id[%lld].fi=%lld if[%lld].se=%lld w=%lld\n&quot;,j,id[j].fi,j,id[j].se,w);</span></span><br><span class="line">            e[tot].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="built_in">ID</span>(id[j].fi,id[j].se),w));</span><br><span class="line">            e[<span class="built_in">ID</span>(id[j].fi,id[j].se)].<span class="built_in">pb</span>(<span class="built_in">mp</span>(tot,w));</span><br><span class="line">            <span class="built_in">Print</span>(tot,<span class="built_in">ID</span>(id[j].fi,id[j].se),w);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// exit(0);</span></span><br><span class="line">        <span class="built_in">rep</span>(j,<span class="number">1</span>,p[<span class="number">1</span>].id<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(id[j]==<span class="built_in">mp</span>(<span class="number">-1ll</span>,<span class="number">-1ll</span>)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> w=<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span>(j&lt;=m)&#123;w=r[id[j].fi][id[j].se];&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=m+n)&#123;w=c[id[j].fi][id[j].se<span class="number">+1</span>];&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=<span class="number">2</span>*m+n)&#123;w=r[id[j].fi<span class="number">+1</span>][id[j].se];&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;=<span class="number">2</span>*m<span class="number">+2</span>*n)&#123;w=c[id[j].fi][id[j].se];&#125;</span><br><span class="line">            e[tot].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="built_in">ID</span>(id[j].fi,id[j].se),w));</span><br><span class="line">            e[<span class="built_in">ID</span>(id[j].fi,id[j].se)].<span class="built_in">pb</span>(<span class="built_in">mp</span>(tot,w));</span><br><span class="line">            <span class="built_in">Print</span>(tot,<span class="built_in">ID</span>(id[j].fi,id[j].se),w);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// exit(0);</span></span><br><span class="line">        <span class="keyword">if</span>(p[<span class="number">1</span>].co!=p[pc].co) v.<span class="built_in">pb</span>(tot);</span><br><span class="line">        e[tot].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="built_in">ID</span>(n<span class="number">-1</span>,m<span class="number">-1</span>)<span class="number">+1</span>,p[<span class="number">1</span>].w));</span><br><span class="line">        e[<span class="built_in">ID</span>(n<span class="number">-1</span>,m<span class="number">-1</span>)<span class="number">+1</span>].<span class="built_in">pb</span>(<span class="built_in">mp</span>(tot,p[<span class="number">1</span>].w));</span><br><span class="line">        <span class="built_in">Print</span>(tot,<span class="built_in">ID</span>(n<span class="number">-1</span>,m<span class="number">-1</span>)<span class="number">+1</span>,p[<span class="number">1</span>].w);</span><br><span class="line">        <span class="keyword">if</span>(v.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="built_in">rep</span>(i,<span class="number">1</span>,tot)&#123;</span><br><span class="line">                <span class="keyword">while</span>(cnt[i]) e[i].<span class="built_in">pop_back</span>(),cnt[i]--;</span><br><span class="line">            &#125;<span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//初始化完成</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;(<span class="type">int</span>)v.<span class="built_in">size</span>()<span class="number">-1</span>;i++) <span class="built_in">dij</span>(i,v[i]);</span><br><span class="line">        <span class="comment">//最短路</span></span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,(<span class="type">int</span>)v.<span class="built_in">size</span>()<span class="number">-1</span>) xu[i<span class="number">+1</span>]=i;<span class="built_in">rep</span>(i,v.<span class="built_in">size</span>()<span class="number">+1</span>,<span class="number">2</span>*v.<span class="built_in">size</span>()) xu[i]=xu[i-v.<span class="built_in">size</span>()];</span><br><span class="line">        <span class="type">int</span> len=<span class="number">2</span>*v.<span class="built_in">size</span>();</span><br><span class="line">        <span class="comment">// rep(i,1,len/2)rep(j,1,len/2) printf(&quot;w[%lld][%lld]=%lld\n&quot;,xu[i],xu[j],w[xu[i]][xu[j]]);</span></span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,len<span class="number">-1</span>) f[i][i<span class="number">+1</span>]=w[xu[i]][xu[i<span class="number">+1</span>]];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">4</span>;i&lt;=len;i+=<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="built_in">rep</span>(j,<span class="number">1</span>,len-i<span class="number">+1</span>)&#123;</span><br><span class="line">                <span class="type">int</span> l=j,r=j+i<span class="number">-1</span>;</span><br><span class="line">                f[l][r]=f[l<span class="number">+1</span>][r<span class="number">-1</span>]+w[xu[l]][xu[r]];</span><br><span class="line">                <span class="built_in">rep</span>(k,l,r<span class="number">-1</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>((k-l<span class="number">+1</span>)&amp;<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">                    f[l][r]=<span class="built_in">min</span>(f[l][r],f[l][k]+f[k<span class="number">+1</span>][r]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// printf(&quot;f[%d][%d]=%d\n&quot;,l,r,f[l][r]);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printf(&quot;e[9307].size()=%d\n&quot;,e[9307].size());</span></span><br><span class="line">        <span class="type">int</span> ans=INF;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,len/<span class="number">2</span><span class="number">+1</span>) ans=<span class="built_in">min</span>(ans,f[i][i+len/<span class="number">2</span><span class="number">-1</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,len) xu[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,tot)&#123;</span><br><span class="line">            <span class="comment">// assert(cnt[i]&gt;=0);</span></span><br><span class="line">            <span class="keyword">while</span>(cnt[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(e[i].<span class="built_in">empty</span>()) <span class="built_in">assert</span>(<span class="number">0</span>);</span><br><span class="line">                e[i].<span class="built_in">pop_back</span>();</span><br><span class="line">                cnt[i]--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// exit(0);</span></span><br><span class="line">    &#125;wx0</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>犯的错误：</p>
<ul>
<li>建边时下标弄错。</li>
<li>建图出错。</li>
<li>小于等于写成小于。</li>
</ul>
<h1 id="CF1194G-Another-Meme-Problem"><a href="#CF1194G-Another-Meme-Problem" class="headerlink" title="CF1194G Another Meme Problem"></a>CF1194G Another Meme Problem</h1><p>首先考虑可以枚举 $a,b$，然后对 $ax,bx$ 中的 $x$ 来 DP，只需要记录进位，是否存在 $a,b$，以及是否小于 $n$。但是有可能一对 $A,B$ 可能对应多个 $a,b$,所以我们规定 $a,b$ 互质，但是有可能一个 $A,B$，对应的 $a,b$ 并不互质，而 $a,b$ 只有可能是 $a’,b’$ $1$ 到 $4$ 倍，所以我们改一下 DP 状态，记录是否存在 $a,b$ 和它们的 $1$ 至 $4$ 倍即可。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mset(a,b) memset((a),(b),sizeof((a)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,l,r) for(int i=(l);i&lt;=(r);i++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dec(i,l,r) for(int i=(r);i&gt;=(l);i--)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cmax(a,b) (((a)&lt;(b))?(a=b):(a))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cmin(a,b) (((a)&gt;(b))?(a=b):(a))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Next(k) for(int x=head[k];x;x=li[x].next)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> vc vector</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ar array</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pi pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 110</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M number</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> dd;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">double</span> ld;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> uint;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; P;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="type">int</span>&gt; vi;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> dd eps=<span class="number">1e-9</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> c=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">for</span>(;!<span class="built_in">isdigit</span>(c);c=<span class="built_in">getchar</span>()) <span class="keyword">if</span>(c == <span class="string">&#x27;-&#x27;</span>) f=-f;</span><br><span class="line">    <span class="keyword">for</span>(;<span class="built_in">isdigit</span>(c);c=<span class="built_in">getchar</span>()) x=x*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    x*=f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> c[N],n,f[N][<span class="number">21</span>][<span class="number">21</span>][<span class="number">4</span>][<span class="number">4</span>][<span class="number">4</span>][<span class="number">4</span>][<span class="number">2</span>][<span class="number">2</span>],a,b;</span><br><span class="line">string s;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">cm</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j,<span class="type">int</span> co)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;j) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(i&gt;j) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> co;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;<span class="keyword">return</span> b==<span class="number">0</span>?a:<span class="built_in">gcd</span>(b,a%b);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> posi,<span class="type">int</span> axj,<span class="type">int</span> bxj,<span class="type">int</span> s1,<span class="type">int</span> s2,<span class="type">int</span> s3,<span class="type">int</span> s4,<span class="type">int</span> lim1,<span class="type">int</span> lim2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(posi==n<span class="number">+1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!axj&amp;&amp;!bxj&amp;&amp;!lim1&amp;&amp;!lim2&amp;&amp;(s1==<span class="number">3</span>||s2==<span class="number">3</span>||s3==<span class="number">3</span>||s4==<span class="number">3</span>)) <span class="keyword">return</span> <span class="number">1</span>;<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> &amp;now=f[posi][axj][bxj][s1][s2][s3][s4][lim1][lim2];</span><br><span class="line">    <span class="keyword">if</span>(now!=<span class="number">-1</span>) <span class="keyword">return</span> now;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">9</span>)&#123;</span><br><span class="line">        <span class="type">int</span> nowa=(i*a+axj)%<span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> nowaxj=(i*a+axj)/<span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> nowb=(i*b+bxj)%<span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> nowbxj=(i*b+bxj)/<span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> nows1=s1|((nowa==a)&lt;&lt;<span class="number">1</span>)|(nowb==b);</span><br><span class="line">        <span class="type">int</span> nows2=s2|((nowa==a*<span class="number">2</span>)&lt;&lt;<span class="number">1</span>)|(nowb==b*<span class="number">2</span>);</span><br><span class="line">        <span class="type">int</span> nows3=s3|((nowa==a*<span class="number">3</span>)&lt;&lt;<span class="number">1</span>)|(nowb==b*<span class="number">3</span>);</span><br><span class="line">        <span class="type">int</span> nows4=s4|((nowa==a*<span class="number">4</span>)&lt;&lt;<span class="number">1</span>)|(nowb==b*<span class="number">4</span>);</span><br><span class="line">        ans=(ans+<span class="built_in">dfs</span>(posi<span class="number">+1</span>,nowaxj,nowbxj,nows1,nows2,nows3,nows4,<span class="built_in">cm</span>(nowa,c[posi],lim1),<span class="built_in">cm</span>(nowb,c[posi],lim2)))%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    now=ans;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;my.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;my.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    cin&gt;&gt;s;<span class="type">int</span> len=s.<span class="built_in">length</span>()<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">dec</span>(i,<span class="number">0</span>,len) c[len-i]=s[i]-<span class="string">&#x27;0&#x27;</span>;n=len;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> now=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,n)&#123;</span><br><span class="line">        ans=(ans+c[i]*now%mod)%mod;now=now*<span class="number">10</span>%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// printf(&quot;ans=%d\n&quot;,ans);</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">9</span>)<span class="built_in">rep</span>(j,i<span class="number">+1</span>,<span class="number">9</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">gcd</span>(i,j)!=<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">mset</span>(f,<span class="number">-1</span>);</span><br><span class="line">        a=i;</span><br><span class="line">        b=j;</span><br><span class="line">        <span class="comment">// ans=(ans+dfs(0,0,0,0,0,0,0,0,0))%mod;</span></span><br><span class="line">        <span class="type">int</span> nowans=<span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// printf(&quot;a=%d b=%d ans=%d\n&quot;,a,b,nowans);</span></span><br><span class="line">        ans=(ans+nowans*<span class="number">2</span>%mod)%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>HYLTianMeng</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E8%B4%AA%E5%BF%83/"># 贪心</a>
                    
                        <a href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"># 网络流</a>
                    
                        <a href="/tags/%E8%BD%BB%E9%87%8D%E9%93%BE%E5%89%96%E5%88%86/"># 轻重链剖分</a>
                    
                        <a href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"># 线性代数</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/09/12/%E6%88%91%E4%BB%AC%E4%BB%8D%E6%9C%AA%E7%9F%A5%E9%81%93%E9%82%A3%E4%BA%9B%E9%A2%98%E7%9A%84%E8%A7%A3%E6%B3%95/">我们仍未知道那些题的解法</a>
            
            
            <a class="next" rel="next" href="/2022/09/08/%E7%8B%84%E5%88%A9%E5%85%8B%E9%9B%B7%E5%8D%B7%E7%A7%AF%E5%89%8D%E7%BC%80%E5%92%8C/">狄利克雷卷积前缀和</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© HYLTianMeng | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>